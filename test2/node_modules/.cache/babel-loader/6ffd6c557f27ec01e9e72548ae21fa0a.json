{"ast":null,"code":"// import { useEffect } from \"react\";\n// import SessionContext from '../../SessionContext';\nexport default function setSubscriptions(callObject, viewMode = null) {\n  if (!window.sessionState) {\n    return;\n  }\n\n  console.log('Setting subscriptions...');\n  console.log('****My role is: ' + window.myRole);\n  let subscribedTo = 0;\n  window.currentSubs = []; //if session is active, set currentSubs according to my role\n\n  if (!viewMode && window.sessionState.isActive) {\n    switch (window.myRole) {\n      case 'Participant1':\n        window.currentSubs = [];\n        window.sessionState.roleOf.Actor2 && window.currentSubs.push(window.sessionState.roleOf.Actor2);\n        !window.sessionState.roleOf.Actor2 && window.sessionState.roleOf.Participant2 && window.currentSubs.push(window.sessionState.roleOf.Participant2);\n        break;\n\n      case 'Participant2':\n        window.currentSubs = [];\n        window.sessionState.roleOf.Actor1 && window.currentSubs.push(window.sessionState.roleOf.Actor1);\n        !window.sessionState.roleOf.Actor1 && window.sessionState.roleOf.Participant1 && window.currentSubs.push(window.sessionState.roleOf.Participant1);\n        break;\n\n      case 'Actor1':\n        window.currentSubs = [];\n        window.sessionState.roleOf.Participant2 && window.currentSubs.push(window.sessionState.roleOf.Participant2);\n        window.sessionState.roleOf.Participant1 && window.currentSubs.push(window.sessionState.roleOf.Participant1 + '_AUDIO');\n        break;\n\n      case 'Actor2':\n        window.currentSubs = [];\n        window.sessionState.roleOf.Participant1 && window.currentSubs.push(window.sessionState.roleOf.Participant1);\n        window.sessionState.roleOf.Participant2 && window.currentSubs.push(window.sessionState.roleOf.Participant2 + '_AUDIO');\n        break;\n\n      case 'Attendee':\n        window.currentSubs = [];\n        break;\n\n      default:\n        window.currentSubs = [];\n        break;\n    } //Add Admin to currentSubs if applicable\n\n\n    if (window.sessionState.AdminVisible) {\n      window.currentSubs.push(\"Admin\");\n    }\n  }\n\n  if (viewMode) {\n    switch (viewMode) {\n      case 'Room1':\n        window.currentSubs = [];\n        window.sessionState.roleOf.Participant1 && window.currentSubs.push(window.sessionState.roleOf.Participant1);\n        window.sessionState.roleOf.Actor2 && window.currentSubs.push(window.sessionState.roleOf.Actor2);\n        !window.sessionState.roleOf.Actor2 && window.sessionState.roleOf.Participant1 && window.sessionState.roleOf.Participant2 && window.sessionState.roleOf.Actor1 && window.currentSubs.push(window.sessionState.roleOf.Participant2);\n        break;\n\n      case 'Room2':\n        window.currentSubs = [];\n        window.sessionState.roleOf.Participant2 && window.currentSubs.push(window.sessionState.roleOf.Participant2);\n        window.sessionState.roleOf.Actor1 && window.currentSubs.push(window.sessionState.roleOf.Actor1);\n        !window.sessionState.roleOf.Actor1 && window.sessionState.roleOf.Participant1 && window.sessionState.roleOf.Participant2 && window.sessionState.roleOf.Actor2 && window.currentSubs.push(window.sessionState.roleOf.Participant1);\n        break;\n\n      case 'Participants':\n        window.currentSubs = [];\n        window.sessionState.roleOf.Participant1 && window.currentSubs.push(window.sessionState.roleOf.Participant1);\n        window.sessionState.roleOf.Participant2 && window.currentSubs.push(window.sessionState.roleOf.Participant2);\n        break;\n\n      case 'Actors':\n        window.currentSubs = [];\n        window.sessionState.roleOf.Actor1 && window.currentSubs.push(window.sessionState.roleOf.Actor1);\n        window.sessionState.roleOf.Actor2 && window.currentSubs.push(window.sessionState.roleOf.Actor2);\n        break;\n\n      case 'All':\n        window.currentSubs = [];\n        window.sessionState.roleOf.Participant1 && window.currentSubs.push(window.sessionState.roleOf.Participant1);\n        window.sessionState.roleOf.Participant2 && window.currentSubs.push(window.sessionState.roleOf.Participant2);\n        window.sessionState.roleOf.Actor1 && window.currentSubs.push(window.sessionState.roleOf.Actor1);\n        window.sessionState.roleOf.Actor2 && window.currentSubs.push(window.sessionState.roleOf.Actor2);\n        break;\n\n      case 'None':\n        window.currentSubs = [];\n        window.sessionState.roleOf.Participant1 && window.currentSubs.push(window.sessionState.roleOf.Participant1);\n        window.sessionState.roleOf.Participant2 && window.currentSubs.push(window.sessionState.roleOf.Participant2);\n        break;\n\n      default:\n        window.currentSubs = [];\n        break;\n    }\n  }\n\n  function setTracks() {\n    return new Promise(resolve => {\n      //cycle through each participant in meeting\n      let ps = callObject.participants();\n      Object.keys(ps).forEach(p => {\n        let participant = ps[p];\n        let thisUserName = participant.user_name;\n\n        if (p === 'local') {\n          return;\n        } //if SESSION STATE NOT KNOWN, don't subscribe to anyone yet\n\n\n        if (!window.sessionState.isKnown) {\n          callObject.updateParticipant(participant.session_id, {\n            setSubscribedTracks: false\n          });\n          return;\n        }\n\n        console.log(\"This username is: \" + thisUserName); //If NOT ACTIVE (and not setting view mode), subscribe to everyone in the meeting\n\n        if (!window.sessionState.isActive && !viewMode) {\n          //audio only if currently Seconding\n          if (window.myRole.includes('Actor')) {\n            switch (window.myRole) {\n              case 'Actor1':\n                if (thisUserName == window.sessionState.roleOf.Participant1 || thisUserName == 'InvisibleScreenShareWidget') {\n                  console.log('Subscribing to audio only for: ' + thisUserName);\n                  callObject.updateParticipant(participant.session_id, {\n                    setSubscribedTracks: false\n                  });\n                  callObject.updateParticipant(participant.session_id, {\n                    setSubscribedTracks: {\n                      audio: true,\n                      video: false,\n                      screenVideo: false\n                    }\n                  });\n                } else {\n                  console.log('Subscribing to: ' + thisUserName);\n                  window.currentSubs.push(thisUserName);\n                  callObject.updateParticipant(participant.session_id, {\n                    setSubscribedTracks: true\n                  });\n                  subscribedTo++;\n                }\n\n                break;\n\n              case 'Actor2':\n                if (thisUserName == window.sessionState.roleOf.Participant2 || thisUserName == 'InvisibleScreenShareWidget') {\n                  console.log('Subscribing to audio only for: ' + thisUserName);\n                  callObject.updateParticipant(participant.session_id, {\n                    setSubscribedTracks: false\n                  });\n                  callObject.updateParticipant(participant.session_id, {\n                    setSubscribedTracks: {\n                      audio: true,\n                      video: false,\n                      screenVideo: false\n                    }\n                  });\n                } else {\n                  console.log('Subscribing to: ' + thisUserName);\n                  window.currentSubs.push(thisUserName);\n                  callObject.updateParticipant(participant.session_id, {\n                    setSubscribedTracks: true\n                  });\n                  subscribedTo++;\n                }\n\n                break;\n\n              default:\n                break;\n            }\n          } // audio and video for everyone else\n          else {\n              //exclude screenshare's in-ear audio stream\n              if (thisUserName == 'InvisibleScreenShareWidget') {\n                console.log('Not subscribing to: ' + thisUserName);\n                callObject.updateParticipant(participant.session_id, {\n                  setSubscribedTracks: false\n                });\n              } else {\n                console.log('Subscribing to: ' + thisUserName);\n                window.currentSubs.push(thisUserName);\n\n                if (!callObject.participants()[participant.session_id].tracks.video.subscribed) {\n                  callObject.updateParticipant(participant.session_id, {\n                    setSubscribedTracks: false\n                  });\n                }\n\n                callObject.updateParticipant(participant.session_id, {\n                  setSubscribedTracks: true\n                });\n                subscribedTo++;\n              }\n            } //  else if (thisUserName=='Admin' && window.sessionState.AdminVisible) {\n          //     console.log('Subscribing to Admin:');\n          //     callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : true});\n          //     subscribedTo++;\n          //     console.log('Subscribed to session id: ' + participant.session_id);\n          // } \n\n        } //IF ACTIVE (or selecting viewmode), just subscribe to those listed in currentSubs;\n        else if (window.sessionState.isActive || viewMode) {\n            if (window.currentSubs.includes(thisUserName + '_AUDIO')) {\n              console.log('Subscribing to audio only for: ' + thisUserName);\n              callObject.updateParticipant(participant.session_id, {\n                setSubscribedTracks: {\n                  audio: true,\n                  video: false,\n                  screenVideo: false\n                }\n              });\n            } else if (window.currentSubs.includes(thisUserName)) {\n              console.log('Subscribing to: ' + thisUserName);\n              callObject.updateParticipant(participant.session_id, {\n                setSubscribedTracks: true\n              });\n              subscribedTo++;\n            } else if (!window.currentSubs.includes(thisUserName)) {\n              console.log('NOT subscribing to: ' + thisUserName);\n              callObject.updateParticipant(participant.session_id, {\n                setSubscribedTracks: false\n              });\n            }\n          }\n      });\n      resolve();\n    });\n  }\n\n  setTracks().then(() => {\n    //remove screenshare widget from currentSubs array\n    const index = window.currentSubs.indexOf('InvisibleScreenShareWidget');\n\n    if (index > -1) {\n      window.currentSubs.splice(index, 1);\n    } //print subscriptions\n\n\n    var iterator = window.currentSubs.values();\n    console.log(\"Currently subscribed to:\");\n\n    for (let elements of iterator) {\n      console.log(elements);\n    }\n\n    if (window.currentSubs.length < 1) {\n      console.log(\"No one.\");\n    }\n\n    window.updateCall();\n    viewMode = null;\n    window.updateTray(); //if no admin (or admin has left), start asking for state\n    // if (adminPresent==false) {\n    //     window.sessionState.isKnown=false;\n    //     if (typeof(stateRequest)!='undefined') {clearInterval(stateRequest);}\n    //     stateRequest = setInterval(getState,2500);\n    //     console.log('no Admin present');\n    // }\n    // if (subscribedTo==0) {\n    //     window.isPopulated = false;\n    //     document.getElementById('empty-room').style.opacity='1';\n    //     if(!!document.querySelector(\"#root > div > div.daily-videos-wrapper > div.daily-video-div.remote.cam.cam-muted.mic-muted\")){document.querySelector(\"#root > div > div.daily-videos-wrapper > div.daily-video-div.remote.cam.cam-muted.mic-muted\").style.visibility='hidden';}\n    //     if (window.sessionState.isActive==true) {\n    //         document.getElementById('empty-text').innerHTML=\"Hold that thought! üòê <br><br> We're working to fix a connection problem.\"\n    //     } else if (window.sessionState.isActive==false) {\n    //         document.getElementById('empty-text').innerHTML=\"üëã <br>You're here!<br>Waiting for everyone else...\"\n    //     }\n    // } else if (subscribedTo>0) {\n    //     window.isPopulated = true;\n    //     document.getElementById('empty-room').style.opacity='0';\n    //     if (document.querySelector(\"#root > div > div.daily-videos-wrapper > div.daily-video-div.remote.cam.cam-muted.mic-muted\")){\n    //         document.querySelector(\"#root > div > div.daily-videos-wrapper > div.daily-video-div.remote.cam.cam-muted.mic-muted\").style.visibility='visible';\n    //     }\n    // }\n  });\n}\n;","map":{"version":3,"sources":["/Users/arlosb/Documents/GitHub/new react app/test1/src/hooks/setSubscriptions.js"],"names":["setSubscriptions","callObject","viewMode","window","sessionState","console","log","myRole","subscribedTo","currentSubs","isActive","roleOf","Actor2","push","Participant2","Actor1","Participant1","AdminVisible","setTracks","Promise","resolve","ps","participants","Object","keys","forEach","p","participant","thisUserName","user_name","isKnown","updateParticipant","session_id","setSubscribedTracks","includes","audio","video","screenVideo","tracks","subscribed","then","index","indexOf","splice","iterator","values","elements","length","updateCall","updateTray"],"mappings":"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","sourcesContent":["// import { useEffect } from \"react\";\n// import SessionContext from '../../SessionContext';\n\nexport default function setSubscriptions(callObject,viewMode=null) {\n\n    if (!window.sessionState) {return;}\n\n    console.log('Setting subscriptions...');\n    console.log('****My role is: ' + window.myRole);\n    let subscribedTo=0;\n    window.currentSubs=[];\n    \n    //if session is active, set currentSubs according to my role\n        if (!viewMode && window.sessionState.isActive) {\n            switch (window.myRole) {\n                case 'Participant1':\n                    window.currentSubs=[];\n                    window.sessionState.roleOf.Actor2 && window.currentSubs.push(window.sessionState.roleOf.Actor2);\n                    !window.sessionState.roleOf.Actor2 && window.sessionState.roleOf.Participant2 && window.currentSubs.push(window.sessionState.roleOf.Participant2);\n                    break;\n                case 'Participant2':\n                    window.currentSubs=[];\n                    window.sessionState.roleOf.Actor1 && window.currentSubs.push(window.sessionState.roleOf.Actor1);\n                    !window.sessionState.roleOf.Actor1 && window.sessionState.roleOf.Participant1 && window.currentSubs.push(window.sessionState.roleOf.Participant1);\n                    break;\n                case 'Actor1':\n                    window.currentSubs=[];\n                    window.sessionState.roleOf.Participant2 && window.currentSubs.push(window.sessionState.roleOf.Participant2);\n                    window.sessionState.roleOf.Participant1 && window.currentSubs.push(window.sessionState.roleOf.Participant1+'_AUDIO');\n                    break;\n                case 'Actor2':\n                    window.currentSubs=[];\n                    window.sessionState.roleOf.Participant1 && window.currentSubs.push(window.sessionState.roleOf.Participant1);\n                    window.sessionState.roleOf.Participant2 && window.currentSubs.push(window.sessionState.roleOf.Participant2+'_AUDIO');\n                    break;\n                case 'Attendee':\n                    window.currentSubs=[];\n                    break;\n                default:\n                    window.currentSubs=[];\n                    break;\n            }\n            //Add Admin to currentSubs if applicable\n            if (window.sessionState.AdminVisible) {\n            window.currentSubs.push (\"Admin\");\n        }\n    }\n\n    if(viewMode) {\n        switch (viewMode) {\n            case 'Room1':\n                window.currentSubs=[];\n                window.sessionState.roleOf.Participant1 && window.currentSubs.push(window.sessionState.roleOf.Participant1);\n                window.sessionState.roleOf.Actor2 && window.currentSubs.push(window.sessionState.roleOf.Actor2);\n                !window.sessionState.roleOf.Actor2 && window.sessionState.roleOf.Participant1 && window.sessionState.roleOf.Participant2 && window.sessionState.roleOf.Actor1 && window.currentSubs.push(window.sessionState.roleOf.Participant2);\n                break;\n            case 'Room2':\n                window.currentSubs=[];\n                window.sessionState.roleOf.Participant2 && window.currentSubs.push(window.sessionState.roleOf.Participant2);\n                window.sessionState.roleOf.Actor1 && window.currentSubs.push(window.sessionState.roleOf.Actor1);\n                !window.sessionState.roleOf.Actor1 && window.sessionState.roleOf.Participant1 && window.sessionState.roleOf.Participant2 && window.sessionState.roleOf.Actor2 && window.currentSubs.push(window.sessionState.roleOf.Participant1);\n                break;\n            case 'Participants':\n                window.currentSubs=[];\n                window.sessionState.roleOf.Participant1 && window.currentSubs.push(window.sessionState.roleOf.Participant1);\n                window.sessionState.roleOf.Participant2 && window.currentSubs.push(window.sessionState.roleOf.Participant2);\n                break;\n            case 'Actors':\n                window.currentSubs=[];\n                window.sessionState.roleOf.Actor1 && window.currentSubs.push(window.sessionState.roleOf.Actor1);\n                window.sessionState.roleOf.Actor2 && window.currentSubs.push(window.sessionState.roleOf.Actor2);\n                break;\n            case 'All':\n                window.currentSubs=[];\n                window.sessionState.roleOf.Participant1 && window.currentSubs.push(window.sessionState.roleOf.Participant1);\n                window.sessionState.roleOf.Participant2 && window.currentSubs.push(window.sessionState.roleOf.Participant2);\n                window.sessionState.roleOf.Actor1 && window.currentSubs.push(window.sessionState.roleOf.Actor1);\n                window.sessionState.roleOf.Actor2 && window.currentSubs.push(window.sessionState.roleOf.Actor2);\n                break;\n            case 'None':\n                window.currentSubs=[];\n                window.sessionState.roleOf.Participant1 && window.currentSubs.push(window.sessionState.roleOf.Participant1);\n                window.sessionState.roleOf.Participant2 && window.currentSubs.push(window.sessionState.roleOf.Participant2);\n                break;\n            default:\n                window.currentSubs=[];\n                break;\n        }\n    }\n\n    \n    function setTracks() {\n\n        return new Promise( (resolve) => {\n\n            //cycle through each participant in meeting\n            let ps = callObject.participants();\n            Object.keys(ps).forEach((p) => {\n\n                let participant = ps[p];\n                let thisUserName = participant.user_name;\n\n                if (p === 'local') {\n                    return;\n                } \n\n                //if SESSION STATE NOT KNOWN, don't subscribe to anyone yet\n                if (!window.sessionState.isKnown) {\n                    callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : false});\n                    return;\n                }\n\n\n\n                console.log(\"This username is: \" +thisUserName);\n                //If NOT ACTIVE (and not setting view mode), subscribe to everyone in the meeting\n                if (!window.sessionState.isActive && !viewMode) {\n\n                    //audio only if currently Seconding\n                    if (window.myRole.includes('Actor')) {\n                        switch (window.myRole) {\n                            case 'Actor1':\n                                    if (thisUserName==window.sessionState.roleOf.Participant1 || thisUserName=='InvisibleScreenShareWidget') {\n                                        console.log('Subscribing to audio only for: ' + thisUserName);\n                                        callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : false});\n                                        callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : { audio: true, video: false, screenVideo: false}});\n                                    } else {\n                                        console.log('Subscribing to: ' + thisUserName);\n                                        window.currentSubs.push(thisUserName);\n                                        callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : true});\n                                        subscribedTo++;\n                                    }\n                                break;\n                            case 'Actor2':\n                                if (thisUserName==window.sessionState.roleOf.Participant2 || thisUserName=='InvisibleScreenShareWidget') {\n                                    console.log('Subscribing to audio only for: ' + thisUserName);\n                                    callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : false});\n                                    callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : { audio: true, video: false, screenVideo: false}});\n                                } else {\n                                    console.log('Subscribing to: ' + thisUserName);\n                                    window.currentSubs.push(thisUserName);\n                                    callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : true});\n                                    subscribedTo++;\n                                }\n                            break;\n                        \n                            default:\n                                break;\n                        }\n                    }\n\n                    // audio and video for everyone else\n                    else {  \n                        //exclude screenshare's in-ear audio stream\n                        if (thisUserName=='InvisibleScreenShareWidget') {\n                            console.log('Not subscribing to: ' + thisUserName);\n                            callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : false});\n                        \n                        } else {\n                            console.log('Subscribing to: ' + thisUserName);\n                            window.currentSubs.push(thisUserName);\n                            if (!callObject.participants()[participant.session_id].tracks.video.subscribed){\n                                callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : false});\n                            }\n                            callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : true});\n                            subscribedTo++;\n                            }\n                        \n                    }\n                    //  else if (thisUserName=='Admin' && window.sessionState.AdminVisible) {\n                    //     console.log('Subscribing to Admin:');\n                    //     callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : true});\n                    //     subscribedTo++;\n                    //     console.log('Subscribed to session id: ' + participant.session_id);\n                    // } \n\n                } \n\n                //IF ACTIVE (or selecting viewmode), just subscribe to those listed in currentSubs;\n                else if (window.sessionState.isActive || viewMode) {\n                    if(window.currentSubs.includes(thisUserName+'_AUDIO')) {\n                        console.log('Subscribing to audio only for: ' + thisUserName);\n                        callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : { audio: true, video: false, screenVideo: false}});\n                    }\n                    else if(window.currentSubs.includes(thisUserName)) {\n                        console.log('Subscribing to: ' + thisUserName);\n                        callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : true});\n                        subscribedTo++;\n                    }\n                    else if (!window.currentSubs.includes(thisUserName)) {\n                        console.log('NOT subscribing to: ' + thisUserName);\n                        callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : false});\n                    }\n                }\n            });\n            resolve()\n        })\n    }\n    \n    setTracks().then(()=>{\n        //remove screenshare widget from currentSubs array\n        \n        const index = window.currentSubs.indexOf('InvisibleScreenShareWidget');\n        if (index > -1) {\n          window.currentSubs.splice(index, 1);\n        }\n    //print subscriptions\n\n    var iterator = window.currentSubs.values();\n    console.log(\"Currently subscribed to:\");\n    for (let elements of iterator) { \n        console.log(elements); \n    } \n    if (window.currentSubs.length < 1) {\n        console.log (\"No one.\")\n    }\n    window.updateCall();\n    viewMode=null;\n    window.updateTray();\n\n\n        //if no admin (or admin has left), start asking for state\n        // if (adminPresent==false) {\n        //     window.sessionState.isKnown=false;\n        //     if (typeof(stateRequest)!='undefined') {clearInterval(stateRequest);}\n        //     stateRequest = setInterval(getState,2500);\n        //     console.log('no Admin present');\n        // }\n        // if (subscribedTo==0) {\n        //     window.isPopulated = false;\n        //     document.getElementById('empty-room').style.opacity='1';\n        //     if(!!document.querySelector(\"#root > div > div.daily-videos-wrapper > div.daily-video-div.remote.cam.cam-muted.mic-muted\")){document.querySelector(\"#root > div > div.daily-videos-wrapper > div.daily-video-div.remote.cam.cam-muted.mic-muted\").style.visibility='hidden';}\n        //     if (window.sessionState.isActive==true) {\n        //         document.getElementById('empty-text').innerHTML=\"Hold that thought! üòê <br><br> We're working to fix a connection problem.\"\n        //     } else if (window.sessionState.isActive==false) {\n        //         document.getElementById('empty-text').innerHTML=\"üëã <br>You're here!<br>Waiting for everyone else...\"\n\n        //     }\n        // } else if (subscribedTo>0) {\n        //     window.isPopulated = true;\n        //     document.getElementById('empty-room').style.opacity='0';\n        //     if (document.querySelector(\"#root > div > div.daily-videos-wrapper > div.daily-video-div.remote.cam.cam-muted.mic-muted\")){\n        //         document.querySelector(\"#root > div > div.daily-videos-wrapper > div.daily-video-div.remote.cam.cam-muted.mic-muted\").style.visibility='visible';\n        //     }\n\n        // }\n\n    })\n\n    \n   \n};\n\n"]},"metadata":{},"sourceType":"module"}