{"ast":null,"code":"import _createForOfIteratorHelper from\"/Users/arlosb/Documents/GitHub/new react app/test2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _slicedToArray from\"/Users/arlosb/Documents/GitHub/new react app/test2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useContext,useReducer,useCallback,useState}from'react';import'./Call.css';import Tile from'../Tile/Tile';import CallObjectContext from'../../CallObjectContext';// import MyInfoContext from '../../MyInfoContext';\n// import SessionContext from '../../SessionContext';\nimport CallMessage from'../CallMessage/CallMessage';import{initialCallState,CLICK_ALLOW_TIMEOUT,PARTICIPANTS_CHANGE,CAM_OR_MIC_ERROR,FATAL_ERROR,callReducer,isLocal,isScreenShare,containsScreenShare,getMessage}from'./callState';import{logDailyEvent}from'../../logUtils';import setSubscriptions from'../../hooks/setSubscriptions';function useForceUpdate(){var _useState=useState(0),_useState2=_slicedToArray(_useState,2),value=_useState2[0],setValue=_useState2[1];// integer state\nreturn function(){return setValue(function(value){return value+1;});};// update the state to force render\n}export default function Call(){var callObject=useContext(CallObjectContext);// const [ sessionState, setSessionState ] = useContext(SessionContext);\n// const [ myInfo, setMyInfo ] = useContext(MyInfoContext);\nvar _useReducer=useReducer(callReducer,initialCallState),_useReducer2=_slicedToArray(_useReducer,2),callState=_useReducer2[0],dispatch=_useReducer2[1];var forceUpdate=useForceUpdate();window.updateCall=function(){forceUpdate();};/**\n   * Start listening for participant changes, when the callObject is set.\n   */useEffect(function(){if(!callObject)return;var events=['participant-joined','participant-updated','participant-left'];function handleNewParticipantsState(e){e&&logDailyEvent(e);dispatch({type:PARTICIPANTS_CHANGE,participants:callObject.participants()});if(e&&e.action!='participant-updated'){setSubscriptions(callObject);console.log(\"setting subscriptions because: \"+e.action);var thisUserName=e.participant.user_name;var thisSessionID=e.participant.session_id;if(e.action==\"participant-joined\"){var updateUserList=function updateUserList(thisUserName){var SessionIDLabel=thisUserName+\"_SessionID\";window[SessionIDLabel]=thisSessionID;if(thisUserName=='SUPERDUPER'){return;}console.log('********Adding user to list: '+thisUserName);window.userList.push(thisUserName);if(typeof window.updateAdminPanel!=='undefined'){window.updateAdminPanel();};if(thisUserName=='Admin'){window.adminPresent=true;}};window.event=e;var getUserName=setInterval(function(){if(thisUserName){console.log(\"*****this user is: \".concat(thisUserName));updateUserList(thisUserName);clearInterval(getUserName);}else{var participants=callObject.participants();for(var participant in participants){if(participants[participant].session_id==thisSessionID){thisUserName=participants[participant].user_name;}}}},100);}else if(e.action==\"participant-left\"){//remove from userList\nvar index=window.userList.indexOf(thisUserName);if(index>-1){window.userList.splice(index,1);}if(window.userList.indexOf('Admin')==-1){window.adminPresent=false;}}console.log('Admin present: '+window.adminPresent);console.log('UserList: '+window.userList);}}// Use initial state\nhandleNewParticipantsState();// Listen for changes in state\nfor(var _i=0,_events=events;_i<_events.length;_i++){var event=_events[_i];callObject.on(event,handleNewParticipantsState);}// Stop listening for changes in state\nreturn function cleanup(){var _iterator=_createForOfIteratorHelper(events),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var _event=_step.value;callObject.off(_event,handleNewParticipantsState);}}catch(err){_iterator.e(err);}finally{_iterator.f();}};},[callObject]);/**\n   * Start listening for call errors, when the callObject is set.\n   */useEffect(function(){if(!callObject)return;function handleCameraErrorEvent(event){logDailyEvent(event);dispatch({type:CAM_OR_MIC_ERROR,message:event&&event.errorMsg&&event.errorMsg.errorMsg||'Unknown'});}// We're making an assumption here: there is no camera error when callObject\n// is first assigned.\ncallObject.on('camera-error',handleCameraErrorEvent);return function cleanup(){callObject.off('camera-error',handleCameraErrorEvent);};},[callObject]);/**\n   * Start listening for fatal errors, when the callObject is set.\n   */useEffect(function(){if(!callObject)return;function handleErrorEvent(e){logDailyEvent(e);dispatch({type:FATAL_ERROR,message:e&&e.errorMsg||'Unknown'});}// We're making an assumption here: there is no error when callObject is\n// first assigned.\ncallObject.on('error',handleErrorEvent);return function cleanup(){callObject.off('error',handleErrorEvent);};},[callObject]);/**\n   * Start a timer to show the \"click allow\" message, when the component mounts.\n   */useEffect(function(){var t=setTimeout(function(){dispatch({type:CLICK_ALLOW_TIMEOUT});},2500);return function cleanup(){clearTimeout(t);};},[]);var numberOfSubs=window.currentSubs&&window.currentSubs.filter(function(str){return str.indexOf('_AUDIO')===-1;}).filter(function(str){return str.indexOf('_AUDIO')===-1;}).filter(function(str){return str.indexOf(window.myName)===-1;}).length;//number of subs, not counting audio-only or my name\nuseEffect(function(){window.numberOfSubs=numberOfSubs;},[numberOfSubs]);function getTiles(){var largeTiles=[];var smallTiles=[];Object.entries(callState.callItems).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),id=_ref2[0],callItem=_ref2[1];var isAudioOnly=function isAudioOnly(){if(!callItem.audioTrackState||!callItem.videoTrackState){return;}return callItem.audioTrackState.subscribed&&!callItem.videoTrackState.subscribed;};var isLarge=isScreenShare(id)||!isLocal(id)&&!containsScreenShare(callState.callItems)||isLocal(id)&&numberOfSubs&&numberOfSubs>1&&!containsScreenShare(callState.callItems);//videoTrackState()\nvar tile=/*#__PURE__*/React.createElement(Tile,{key:id,videoTrackState:callItem.videoTrackState,audioTrackState:callItem.audioTrackState,isLocalPerson:isLocal(id),isAudioOnly:isAudioOnly(),isLarge:isLarge,disableCornerMessage:isScreenShare(id),isScreenShare:isScreenShare(id)// onClick={\n//   isLocal(id)\n//     ? null\n//     : () => {\n//         sendHello(id);\n//       }\n// }\n});if(isLarge){largeTiles.push(tile);}else{smallTiles.push(tile);}});return[largeTiles,smallTiles];}var _getTiles=getTiles(),_getTiles2=_slicedToArray(_getTiles,2),largeTiles=_getTiles2[0],smallTiles=_getTiles2[1];/**\n   * DELETE: Attached tiles objects to window for debugging purposes.\n   */useEffect(function(){console.log('re-rendered');// console.log('Userlist: ' + window.userList);\nwindow.largeTiles=largeTiles;window.smallTales=smallTiles;window.add=function(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;for(var i=0;i<n;i++){callObject.addFakeParticipant();}};});// attach callState to window for debugging\nuseEffect(function(){window.callState=callState;},[callState]);var message=getMessage(callState);return/*#__PURE__*/React.createElement(\"div\",{className:\"call\"},/*#__PURE__*/React.createElement(\"div\",{className:\"large-tiles count-\".concat(containsScreenShare(callState.callItems)&&'1'||numberOfSubs&&numberOfSubs+1)},!message?largeTiles:null/* Avoid showing large tiles to make room for the message */),/*#__PURE__*/React.createElement(\"div\",{className:\"small-tiles\"},smallTiles),message&&/*#__PURE__*/React.createElement(CallMessage,{header:message.header,detail:message.detail,isError:message.isError}));}","map":{"version":3,"sources":["/Users/arlosb/Documents/GitHub/new react app/test2/src/components/Call/Call.js"],"names":["React","useEffect","useContext","useReducer","useCallback","useState","Tile","CallObjectContext","CallMessage","initialCallState","CLICK_ALLOW_TIMEOUT","PARTICIPANTS_CHANGE","CAM_OR_MIC_ERROR","FATAL_ERROR","callReducer","isLocal","isScreenShare","containsScreenShare","getMessage","logDailyEvent","setSubscriptions","useForceUpdate","value","setValue","Call","callObject","callState","dispatch","forceUpdate","window","updateCall","events","handleNewParticipantsState","e","type","participants","action","console","log","thisUserName","participant","user_name","thisSessionID","session_id","updateUserList","SessionIDLabel","userList","push","updateAdminPanel","adminPresent","event","getUserName","setInterval","clearInterval","index","indexOf","splice","on","cleanup","off","handleCameraErrorEvent","message","errorMsg","handleErrorEvent","t","setTimeout","clearTimeout","numberOfSubs","currentSubs","filter","str","myName","length","getTiles","largeTiles","smallTiles","Object","entries","callItems","forEach","id","callItem","isAudioOnly","audioTrackState","videoTrackState","subscribed","isLarge","tile","smallTales","add","n","i","addFakeParticipant","header","detail","isError"],"mappings":"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","sourcesContent":["import React, { useEffect, useContext, useReducer, useCallback, useState } from 'react';\nimport './Call.css';\nimport Tile from '../Tile/Tile';\nimport CallObjectContext from '../../CallObjectContext';\n// import MyInfoContext from '../../MyInfoContext';\n// import SessionContext from '../../SessionContext';\nimport CallMessage from '../CallMessage/CallMessage';\nimport {\n  initialCallState,\n  CLICK_ALLOW_TIMEOUT,\n  PARTICIPANTS_CHANGE,\n  CAM_OR_MIC_ERROR,\n  FATAL_ERROR,\n  callReducer,\n  isLocal,\n  isScreenShare,\n  containsScreenShare,\n  getMessage,\n} from './callState';\nimport { logDailyEvent } from '../../logUtils';\nimport setSubscriptions from '../../hooks/setSubscriptions';\nfunction useForceUpdate(){\n  const [value, setValue] = useState(0); // integer state\n  return () => setValue(value => value + 1); // update the state to force render\n}\n\nexport default function Call() {\n  const callObject = useContext(CallObjectContext);\n  // const [ sessionState, setSessionState ] = useContext(SessionContext);\n  // const [ myInfo, setMyInfo ] = useContext(MyInfoContext);\n  const [callState, dispatch] = useReducer(callReducer, initialCallState);\n  const forceUpdate = useForceUpdate();\n\n\n  window.updateCall = () => {\n    forceUpdate();\n  }\n\n  /**\n   * Start listening for participant changes, when the callObject is set.\n   */\n  useEffect(() => {\n    if (!callObject) return;\n\n    const events = [\n      'participant-joined',\n      'participant-updated',\n      'participant-left',\n    ];\n\n   \n\n    function handleNewParticipantsState(e) {\n      e && logDailyEvent(e);\n      dispatch({\n        type: PARTICIPANTS_CHANGE,\n        participants: callObject.participants(),\n      });\n      if(e && e.action!='participant-updated') {\n        setSubscriptions(callObject);\n        console.log(\"setting subscriptions because: \" + e.action);\n    \n          let thisUserName = e.participant.user_name;\n          let thisSessionID = e.participant.session_id;\n          if (e.action==\"participant-joined\") {\n            window.event=e;\n            const getUserName = setInterval(\n              ()=>{\n                    if (thisUserName) \n                      {\n                        console.log(`*****this user is: ${thisUserName}`);\n                        updateUserList(thisUserName);\n                        clearInterval(getUserName);\n                      }\n                    else {\n                      let participants = callObject.participants();\n                      for (const participant in participants) {\n                        if (participants[participant].session_id == thisSessionID) {\n                          thisUserName = participants[participant].user_name;\n                        }\n                      }\n                    }\n                  },100);\n\n            function updateUserList(thisUserName) {\n              let SessionIDLabel = thisUserName + \"_SessionID\";\n              window[SessionIDLabel] = thisSessionID;\n              if(thisUserName=='SUPERDUPER') {return;}\n              console.log('********Adding user to list: ' + thisUserName);\n              window.userList.push(thisUserName);\n              if(typeof(window.updateAdminPanel)!=='undefined') {window.updateAdminPanel()};\n              if (thisUserName=='Admin') {\n                  window.adminPresent=true;\n              }\n            }\n\n            \n            \n          } else if (e.action==\"participant-left\") {\n            //remove from userList\n            let index = window.userList.indexOf(thisUserName);\n            if (index > -1) {\n            window.userList.splice(index, 1);\n            }\n            if (window.userList.indexOf('Admin')==-1) {\n              window.adminPresent=false;\n            }\n           \n          }\n\n          console.log('Admin present: ' + window.adminPresent);\n          console.log('UserList: ' + window.userList);\n      }\n      \n    }\n\n    // Use initial state\n    handleNewParticipantsState();\n\n    // Listen for changes in state\n    for (const event of events) {\n      callObject.on(event, handleNewParticipantsState);\n    }\n\n    // Stop listening for changes in state\n    return function cleanup() {\n      for (const event of events) {\n        callObject.off(event, handleNewParticipantsState);\n      }\n    };\n  }, [callObject]);\n\n  /**\n   * Start listening for call errors, when the callObject is set.\n   */\n  useEffect(() => {\n    if (!callObject) return;\n\n    function handleCameraErrorEvent(event) {\n      logDailyEvent(event);\n      dispatch({\n        type: CAM_OR_MIC_ERROR,\n        message:\n          (event && event.errorMsg && event.errorMsg.errorMsg) || 'Unknown',\n      });\n    }\n\n    // We're making an assumption here: there is no camera error when callObject\n    // is first assigned.\n\n    callObject.on('camera-error', handleCameraErrorEvent);\n\n    return function cleanup() {\n      callObject.off('camera-error', handleCameraErrorEvent);\n    };\n  }, [callObject]);\n\n  /**\n   * Start listening for fatal errors, when the callObject is set.\n   */\n  useEffect(() => {\n    if (!callObject) return;\n\n    function handleErrorEvent(e) {\n      logDailyEvent(e);\n      dispatch({\n        type: FATAL_ERROR,\n        message: (e && e.errorMsg) || 'Unknown',\n      });\n    }\n\n    // We're making an assumption here: there is no error when callObject is\n    // first assigned.\n\n    callObject.on('error', handleErrorEvent);\n\n    return function cleanup() {\n      callObject.off('error', handleErrorEvent);\n    };\n  }, [callObject]);\n\n  /**\n   * Start a timer to show the \"click allow\" message, when the component mounts.\n   */\n  useEffect(() => {\n    const t = setTimeout(() => {\n      dispatch({ type: CLICK_ALLOW_TIMEOUT });\n    }, 2500);\n\n    return function cleanup() {\n      clearTimeout(t);\n    };\n  }, []);\n\n  const numberOfSubs = window.currentSubs && window.currentSubs.filter(function (str) {return str.indexOf('_AUDIO') === -1}).filter(function (str) {return str.indexOf('_AUDIO') === -1}).filter(function (str) {return str.indexOf(window.myName) === -1}).length //number of subs, not counting audio-only or my name\n\n\n  useEffect(()=>{\nwindow.numberOfSubs =numberOfSubs;\n  },[numberOfSubs])\n\n\n\n \n\n  function getTiles() {\n    let largeTiles = [];\n    let smallTiles = [];\n    Object.entries(callState.callItems).forEach(([id, callItem]) => {\n\n\n      const isAudioOnly = () => {\n        if(!callItem.audioTrackState || !callItem.videoTrackState) {return}\n        return (callItem.audioTrackState.subscribed && !callItem.videoTrackState.subscribed);\n      }\n\n      const isLarge =\n        isScreenShare(id) ||\n        (!isLocal(id) && !containsScreenShare(callState.callItems)) \n        || (isLocal(id) && numberOfSubs && numberOfSubs>1 && !containsScreenShare(callState.callItems))   //videoTrackState()\n\n        \n      const tile = (\n        <Tile\n          key={id}\n          videoTrackState={callItem.videoTrackState}\n          audioTrackState={callItem.audioTrackState}\n          isLocalPerson={isLocal(id)}\n          isAudioOnly={isAudioOnly()}\n          isLarge={isLarge}\n          disableCornerMessage={isScreenShare(id)}\n          isScreenShare={isScreenShare(id)}\n          // onClick={\n          //   isLocal(id)\n          //     ? null\n          //     : () => {\n          //         sendHello(id);\n          //       }\n          // }\n        />\n      );\n      if (isLarge) {\n        largeTiles.push(tile);\n      } else {\n        smallTiles.push(tile);\n      }\n    });\n    \n    return [largeTiles, smallTiles];\n  }\n\n  const [largeTiles, smallTiles] = getTiles();\n\n  \n  /**\n   * DELETE: Attached tiles objects to window for debugging purposes.\n   */\n  useEffect(() => {\n    console.log('re-rendered');\n    // console.log('Userlist: ' + window.userList);\n    window.largeTiles = largeTiles;\n    window.smallTales = smallTiles;\n    window.add = function(n=1) {\n      for(let i=0;i<n;i++) {\n        callObject.addFakeParticipant()\n      }\n    };\n    \n  }); \n\n\n   // attach callState to window for debugging\n   useEffect(() => {\n    window.callState = callState;\n  }, [callState]); \n\n\n  const message = getMessage(callState);\n  return (\n    <div className=\"call\">\n                                      {/* add # of tiles to class name. alternative: {largeTiles.length}*/}\n      <div className={`large-tiles count-${(containsScreenShare(callState.callItems)&&'1')||numberOfSubs && numberOfSubs+1}`}>   \n        {\n          !message\n            ? largeTiles\n            : null /* Avoid showing large tiles to make room for the message */\n        }\n      </div>\n      <div className=\"small-tiles\">{smallTiles}</div>\n      {message && (\n        <CallMessage\n          header={message.header}\n          detail={message.detail}\n          isError={message.isError}\n        />\n      )}\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}