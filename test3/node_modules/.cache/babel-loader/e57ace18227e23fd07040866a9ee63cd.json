{"ast":null,"code":"import _regeneratorRuntime from\"/Users/arlosb/Documents/GitHub/new react app/test3/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/arlosb/Documents/GitHub/new react app/test3/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _createForOfIteratorHelper from\"/Users/arlosb/Documents/GitHub/new react app/test3/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _slicedToArray from\"/Users/arlosb/Documents/GitHub/new react app/test3/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useCallback}from'react';import Call from'../Call/Call';import StartScreen from'../StartScreen/StartScreen';import api from'../../api';import'./App.css';import Tray from'../Tray/Tray';import CallObjectContext from'../../CallObjectContext';import SessionStateContext from'../../SessionStateContext';import MyContext from'../../MyContext';import{roomUrlFromPageUrl,pageUrlFromRoomUrl}from'../../urlUtils';import DailyIframe from'@daily-co/daily-js';import{logDailyEvent}from'../../logUtils';import setSubscriptions from'../../hooks/setSubscriptions';import{sendState}from'../AdminPanel/AdminFunctions';import audioPlayer from'../../hooks/AudioPlayer';import AdminPanel from'../AdminPanel/AdminPanel';var STATE_IDLE='STATE_IDLE';var STATE_CREATING='STATE_CREATING';var STATE_JOINING='STATE_JOINING';var STATE_JOINED='STATE_JOINED';var STATE_LEAVING='STATE_LEAVING';var STATE_ERROR='STATE_ERROR';export default function App(){var _useState=useState(STATE_IDLE),_useState2=_slicedToArray(_useState,2),appState=_useState2[0],setAppState=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),roomUrl=_useState4[0],setRoomUrl=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),callObject=_useState6[0],setCallObject=_useState6[1];var _useState7=useState({type:'sessionState',isKnown:false,isActive:false,AdminVisible:false,roleOf:{Buyer1:'',Buyer2:'',Buyer3:'',Seller:'',Shadow1:'',Shadow2:'',Shadow3:'',Shadow4:''}}),_useState8=_slicedToArray(_useState7,2),sessionState=_useState8[0],setSessionState=_useState8[1];var _useState9=useState({name:'Your first name',role:'Attendee',adminStatus:false}),_useState10=_slicedToArray(_useState9,2),my=_useState10[0],setMy=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),camDisabled=_useState12[0],setCamDisabled=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),micDisabled=_useState14[0],setMicDisabled=_useState14[1];if(!window.pass.includes(window.myP)){//redirect if password is wrong\nwindow.location.href=\"http://secondbody.co\";}window.setViewMode=function(viewMode){viewMode&&console.log('Changing view mode to: '+viewMode);window.viewMode=viewMode;setSubscriptions(callObject,viewMode);};/**\n   * Creates a new call room.\n   */var createCall=useCallback(function(){setAppState(STATE_CREATING);return api.createRoom().then(function(room){return room.url;}).catch(function(error){console.log('Error creating room',error);setRoomUrl(null);setAppState(STATE_IDLE);});},[]);/**\n   * Starts joining an existing call.\n   *\n   * NOTE: In this demo we show how to completely clean up a call with destroy(),\n   * which requires creating a new call object before you can join() again.\n   * This isn't strictly necessary, but is good practice when you know you'll\n   * be done with the call object for a while and you're no longer listening to its\n   * events.\n   */ /*   \nARLO NOTE:\n      Below is where the trouble is. myInfo.name is set via a child component, <StartScreen>, \n      and it successfully changes myInfo.name (I've confirmed since it's pinned to the Window).\n      The below works... the first time. But then callObject.participants().local.user_name gets \"stuck\", \n      so if you exit and leave, or even refresh the page, it never changes. Weird behavior\n*/var startJoiningCall=useCallback(function(url){// if(!initialInputs) {return}\nvar newCallObject=DailyIframe.createCallObject({subscribeToTracksAutomatically:false});setRoomUrl(url);setCallObject(newCallObject);setAppState(STATE_JOINING);if(window.initialInputs){console.log('initial audio: '+window.initialInputs[0]+'. Initial video: '+window.initialInputs[1]);newCallObject.join({userName:window.myName,url:url,audioSource:window.initialInputs[0],videoSource:window.initialInputs[1]});}else{navigator.mediaDevices.getUserMedia({audio:true,video:true}).then(function(mediaStream){if(mediaStream){var localAudio=mediaStream.getAudioTracks();var localVideo=mediaStream.getVideoTracks();if(localAudio&&localAudio.length>0&&localVideo&&localVideo.length>0){newCallObject.join({userName:my.name,url:url,audioSource:localAudio[0],videoSource:localVideo[0]});}}else{//say something to user, like you don't have any mic or you should allow use mic to this website\n}});}console.log('joining the call as '+my.name);var pageUrl=pageUrlFromRoomUrl(roomUrl)+'&N='+window.myName+'&R='+window.myRole;// let connector = '?';\n// if (pageUrl.includes('?roomUrl=')) {let connector = '&'};\n// if (window.myName) {\n//   if (pageUrl === window.location.href) return;\n//   window.history.replaceState(null, null, pageUrl + connector + \"R=\" + window.myRole + \"&N=\" + window.myName);\n// } else if (window.myRole) {\n//   if (pageUrl === window.location.href) return;\n//   window.history.replaceState(null, null, pageUrl + connector + \"R=\" + window.myRole);\n// } else {\n//   if (pageUrl === window.location.href) return;\n//   window.history.replaceState(null, null, pageUrl);\n// }\n},[]);/**\n   * Starts leaving the current call.\n   */var startLeavingCall=useCallback(function(){if(!callObject)return;// If we're in the error state, we've already \"left\", so just clean up\nif(appState===STATE_ERROR){callObject.destroy().then(function(){setRoomUrl(null);setCallObject(null);setAppState(STATE_IDLE);window.initialize();});}else{setAppState(STATE_LEAVING);callObject.leave();window.initialize();}},[callObject,appState]);/**\n   * If a room's already specified in the page's URL when the component mounts,\n   * join the room.\n   */useEffect(function(){var url=roomUrlFromPageUrl();url&&window.initialInputs&&startJoiningCall(url);},[startJoiningCall]);/**\n   * Update the page's URL to reflect the active call when roomUrl changes.\n   *\n   * This demo uses replaceState rather than pushState in order to avoid a bit\n   * of state-management complexity. See the comments around enableCallButtons\n   * and enableStartButton for more information.\n   */useEffect(function(){var pageUrl=pageUrlFromRoomUrl(roomUrl);window.pageUrl=pageUrl;if(window.myName){if(pageUrl.indexOf('?')>-1){pageUrl+='&N='+window.myName;}else{pageUrl+='?N='+window.myName;}}if(window.myRole){if(pageUrl.indexOf('?')>-1){pageUrl+='&R='+window.myRole;}else{pageUrl+='?R='+window.myRole;}}if(window.myP){if(pageUrl.indexOf('?')>-1){pageUrl+='&P='+window.myP;}else{pageUrl+='?P='+window.myP;}}if(pageUrl===window.location.href)return;window.history.replaceState(null,null,pageUrl);},[roomUrl]);/**\n   * Uncomment to attach call object to window for debugging purposes.\n   */useEffect(function(){window.callObject=callObject;},[callObject]);// Only re-run the effect if callObject changes\nfunction getState(){if(window.sessionState.isKnown==true){clearInterval(window.stateRequest);return;}// if (window.adminPresent) {\ncallObject.sendAppMessage(\"State please?\",'*');console.log('Requesting meeting state...');}var checkIfAdminPresent=function checkIfAdminPresent(){return new Promise(function(resolve){window.adminPresent=false;var ps=callObject.participants();var lookForMoreParticipants=setInterval(function(){//This interval should be redundant, but checking to make sure a dummy user doesn't pop up first\nif(Object.keys(ps).length>1||Object.keys(ps).length<=1&&ps.local.user_name==window.myName){clearInterval(lookForMoreParticipants);for(var p in ps){var thisUserName=ps[p].user_name;if(thisUserName.includes('_Admin')&&p!=='local'){window.adminPresent=true;}console.log(\"Participant present: \".concat(thisUserName));}resolve();}else{return;}},500);});};/**\n   * Update app state based on reported meeting state changes.\n   *\n   * NOTE: Here we're showing how to completely clean up a call with destroy().\n   * This isn't strictly necessary between join()s, but is good practice when\n   * you know you'll be done with the call object for a while and you're no\n   * longer listening to its events.\n   */useEffect(function(){if(!callObject)return;var events=['joined-meeting','left-meeting','error','participant-joined'];function handleNewMeetingState(event){event&&logDailyEvent(event);switch(callObject.meetingState()){case'joined-meeting':setAppState(STATE_JOINED);callObject.setNetworkTopology({topology:'sfu'});window.userList.push(window.myName);console.log('JOINED MEETING');if(window.myName==\"\"){callObject.leave();}if(!window.sessionState.isKnown){if(window.myRole==\"Admin\"){checkIfAdminPresent().then(function(){window.sessionState.isKnown=window.adminPresent?false:true;window.adminPresent?console.log(\"An admin is already present\"):console.log(\"An admin is NOT already present\");if(!window.sessionState.isKnown){window.stateRequest=setInterval(function(){getState();},2500);}});}else{window.stateRequest=setInterval(function(){getState();},2500);}}break;case'left-meeting':callObject.destroy().then(function(){setRoomUrl(null);setCallObject(null);setAppState(STATE_IDLE);clearInterval(window.stateRequest);window.initialize();});break;case'participant-joined':break;case'error':setAppState(STATE_ERROR);break;default:break;}}// Use initial state\nhandleNewMeetingState();// Listen for changes in state\nfor(var _i=0,_events=events;_i<_events.length;_i++){var event=_events[_i];callObject.on(event,handleNewMeetingState);}// Stop listening for changes in state\nreturn function cleanup(){var _iterator=_createForOfIteratorHelper(events),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var _event=_step.value;callObject.off(_event,handleNewMeetingState);}}catch(err){_iterator.e(err);}finally{_iterator.f();}};},[callObject]);/**\n   * Listen for app messages from other call participants.\n   */useEffect(function(){if(!callObject){return;}function handleAppMessage(e){if(e){logDailyEvent(e);console.log(\"received app message from \".concat(e.fromId,\": \"),e.data);var participants=callObject.participants();//handle sessionState updates\nif(e.data.constructor===Object&&e.data.type==\"sessionState\"){var setSubs=function setSubs(){setSubscriptions(callObject);};//temporarily commented out\n// if (e.data.isKnown==false)   //probably redundant. only use received sessionState if isKnown = true\n//     {return;}\n// else if (e.data.isKnown==true && typeof(stateRequest)!='undefined') {   //if state is known, stop asking for state\n//     clearInterval(stateRequest);\n// }\nvar priorSessionState=window.sessionState;window.sessionState=e.data;setSessionState(e.data);var needToSetSubs=false;// change my role if it has been updated in sessionState\nif(window.sessionState.roleOf!=priorSessionState.roleOf){var myNewRole='Attendee';//default, if no role assigned\nfor(var key in window.sessionState.roleOf){if(window.sessionState.roleOf[key]==window.myName){myNewRole=key;}}if(myNewRole!=window.myRole){window.myRole=myNewRole;if(window.myRole.includes('1')){window.myNumber=1;}else if(window.myRole.includes('2')){window.myNumber=2;}}if(window.sessionState.isActive){activateSession();//rebuild UI for the newly assigned role, mid-session\n}needToSetSubs=true;}//create or delete rooms according to assignments of Thirds\n// if (window.sessionState.roleOf.Room3A!='') {\n//     !$(\"#view-mode option[value=Room3\").length>0 && $(\"#view-mode\").append(\"<option value='Room3'>Room3</option>\");\n//   } else {\n//     $(\"#view-mode option[value=Room3\").remove();\n//   }\n// if (window.sessionState.roleOf.Room4A!='') {\n//     !$(\"#view-mode option[value=Room4\").length>0 && $(\"#view-mode\").append(\"<option value='Room4'>Room4</option>\");\n//   } else {\n//     $(\"#view-mode option[value=Room4\").remove();\n//   }\n// if (window.sessionState.roleOf.Room5A!='') {\n//     !$(\"#view-mode option[value=Room5\").length>0 && $(\"#view-mode\").append(\"<option value='Room5'>Room5</option>\");\n//   } else {\n//     $(\"#view-mode option[value=Room5\").remove();\n//   }\n//determine if need to reset subs\nif(priorSessionState.isActive!==window.sessionState.isActive||priorSessionState.AdminVisible!==window.sessionState.AdminVisible){needToSetSubs=true;}//now, reset subscriptions if necessary\nif(needToSetSubs){if(!priorSessionState.isActive&&window.sessionState.isActive&&window.myRole=='Attendee'||window.myRole=='Admin'){setSubscriptions(callObject,'Room1');}else{setSubs();}}//when session starts\nif(priorSessionState.isActive==false&&window.sessionState.isActive==true){activateSession();//set ViewMode when session is started by self. \nif(window.myRole=='Attendee'||window.myRole=='Admin'){if(window.sessionState.roleOf.Shadow1){window.setViewMode('Shadow1');}else if(window.sessionState.roleOf.Shadow2)//fallbacks in case shadow1 is not assigned\n{window.setViewMode('Shadow2');}else if(window.sessionState.roleOf.Shadow3){window.setViewMode('Shadow3');}else if(window.sessionState.roleOf.Shadow4){window.setViewMode('Shadow4');}else if(window.sessionState.roleOf.Seller){window.setViewMode('Seller');}window.camWasOn=callObject.participants().local.video?true:false;window.micWasOn=callObject.participants().local.audio?true:false;callObject.setLocalVideo(false);callObject.setLocalAudio(false);if(!window.amAdmin){setCamDisabled(true);setMicDisabled(true);}}}//when session is paused\nelse if(priorSessionState.isActive==true&&window.sessionState.isActive==false){pauseSession();setCamDisabled(false);setMicDisabled(false);window.setViewMode(null);if(window.camWasOn){callObject.setLocalVideo(true);}if(window.micWasOn){callObject.setLocalAudio(true);}}}else if(e.data.constructor===Object&&e.data.type==\"instructions\"&&e.data.recipient==callObject.participants().local.session_id){audioPlayer(e.data.target,e.data.action);}else if(e.data==\"State please?\"){if(window.amAdmin&&window.sessionState.isKnown){sendState(window.sessionState,callObject);}}}//not used in this module, since there's no timer\n// if none of the above, just overlay the message\n// else if (e.data.constructor !== Object) {    \n//     overlayMessage(e.data,10000);\n// }\nfunction activateSession(){return _activateSession.apply(this,arguments);}function _activateSession(){_activateSession=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.t0=window.myRole;_context.next=_context.t0==='Attendee'?3:_context.t0==='Participant1'?6:_context.t0==='Participant2'?6:_context.t0==='Actor1'?7:_context.t0==='Actor2'?7:_context.t0==='Room3A'?7:_context.t0==='Room3B'?7:_context.t0==='Room4A'?7:_context.t0==='Room4B'?7:_context.t0==='Room5A'?7:_context.t0==='Room5B'?7:8;break;case 3:// $(\"#cam-instructions\").fadeOut(500);\n// $(\"#cam-image\").fadeOut(500);\n// $(\"#mic-instructions\").fadeOut(500);\n// $(\"#mic-image\").fadeOut(500);\n// $('#show-qr-code').fadeOut(500);\n// $('#get-prompt').fadeOut(500);\n// document.getElementById('my-view').style.visibility='visible';\n// $('#my-view').fadeIn(500);\nwindow.camWasOn=callObject.localVideo();if(window.camWasOn){// toggleCam()\n}// $('#view-mode').val('Room1').trigger(\"change\");\n// document.getElementById(\"overlay\").className = \"superimposed-text-attendees\";\n// document.getElementById(\"overlay-text\").className = \"overlay-text-attendees\";\nreturn _context.abrupt(\"break\",9);case 6:return _context.abrupt(\"break\",9);case 7:return _context.abrupt(\"break\",9);case 8:return _context.abrupt(\"break\",9);case 9:case\"end\":return _context.stop();}}},_callee);}));return _activateSession.apply(this,arguments);}function pauseSession(){return _pauseSession.apply(this,arguments);}function _pauseSession(){_pauseSession=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:case\"end\":return _context2.stop();}}},_callee2);}));return _pauseSession.apply(this,arguments);}}//end handleAppMessage\ncallObject.on('app-message',handleAppMessage);return function cleanup(){callObject.off('app-message',handleAppMessage);};},[callObject]);var updateSessionState=function updateSessionState(newSessionState){return setSessionState(newSessionState);};/**\n   * Show the call UI if we're either joining, already joined, or are showing\n   * an error.\n   */var showCall=[STATE_JOINING,STATE_JOINED,STATE_ERROR].includes(appState);/**\n   * Only enable the call buttons (camera toggle, leave call, etc.) if we're joined\n   * or if we've errored out.\n   *\n   * !!!\n   * IMPORTANT: calling callObject.destroy() *before* we get the \"joined-meeting\"\n   * can result in unexpected behavior. Disabling the leave call button\n   * until then avoids this scenario.\n   * !!!\n   */var enableCallButtons=[STATE_JOINED,STATE_ERROR].includes(appState);/**\n   * Only enable the start button if we're in an idle state (i.e. not creating,\n   * joining, etc.).\n   *\n   * !!!\n   * IMPORTANT: only one call object is meant to be used at a time. Creating a\n   * new call object with DailyIframe.createCallObject() *before* your previous\n   * callObject.destroy() completely finishes can result in unexpected behavior.\n   * Disabling the start button until then avoids that scenario.\n   * !!!\n   */var enableStartButton=appState===STATE_IDLE;return/*#__PURE__*/React.createElement(\"div\",{className:\"app\"},/*#__PURE__*/React.createElement(SessionStateContext.Provider,{value:{session:[sessionState,setSessionState]}},/*#__PURE__*/React.createElement(MyContext.Provider,{value:{myState:[my,setMy]}},showCall?/*#__PURE__*/ // NOTE: for an app this size, it's not obvious that using a Context\n// is the best choice. But for larger apps with deeply-nested components\n// that want to access call object state and bind event listeners to the\n// call object, this can be a helpful pattern.\nReact.createElement(CallObjectContext.Provider,{value:callObject},/*#__PURE__*/React.createElement(Call,{roomUrl:roomUrl}),/*#__PURE__*/React.createElement(Tray,{micDisabled:micDisabled,camDisabled:camDisabled,onClickLeaveCall:startLeavingCall}),window.amAdmin&&/*#__PURE__*/React.createElement(AdminPanel,null)):/*#__PURE__*/React.createElement(StartScreen// disabled={!enableStartButton}\n,{onClick:function onClick(){createCall().then(function(url){return startJoiningCall(url);});}}))));}","map":{"version":3,"sources":["/Users/arlosb/Documents/GitHub/new react app/test3/src/components/App/App.js"],"names":["React","useEffect","useState","useCallback","Call","StartScreen","api","Tray","CallObjectContext","SessionStateContext","MyContext","roomUrlFromPageUrl","pageUrlFromRoomUrl","DailyIframe","logDailyEvent","setSubscriptions","sendState","audioPlayer","AdminPanel","STATE_IDLE","STATE_CREATING","STATE_JOINING","STATE_JOINED","STATE_LEAVING","STATE_ERROR","App","appState","setAppState","roomUrl","setRoomUrl","callObject","setCallObject","type","isKnown","isActive","AdminVisible","roleOf","Buyer1","Buyer2","Buyer3","Seller","Shadow1","Shadow2","Shadow3","Shadow4","sessionState","setSessionState","name","role","adminStatus","my","setMy","camDisabled","setCamDisabled","micDisabled","setMicDisabled","window","pass","includes","myP","location","href","setViewMode","viewMode","console","log","createCall","createRoom","then","room","url","catch","error","startJoiningCall","newCallObject","createCallObject","subscribeToTracksAutomatically","initialInputs","join","userName","myName","audioSource","videoSource","navigator","mediaDevices","getUserMedia","audio","video","mediaStream","localAudio","getAudioTracks","localVideo","getVideoTracks","length","pageUrl","myRole","startLeavingCall","destroy","initialize","leave","indexOf","history","replaceState","getState","clearInterval","stateRequest","sendAppMessage","checkIfAdminPresent","Promise","resolve","adminPresent","ps","participants","lookForMoreParticipants","setInterval","Object","keys","local","user_name","p","thisUserName","events","handleNewMeetingState","event","meetingState","setNetworkTopology","topology","userList","push","on","cleanup","off","handleAppMessage","e","fromId","data","constructor","setSubs","priorSessionState","needToSetSubs","myNewRole","key","myNumber","activateSession","camWasOn","micWasOn","setLocalVideo","setLocalAudio","amAdmin","pauseSession","recipient","session_id","target","action","updateSessionState","newSessionState","showCall","enableCallButtons","enableStartButton","session","myState"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useCallback } from 'react';\nimport Call from '../Call/Call';\nimport StartScreen from '../StartScreen/StartScreen';\nimport api from '../../api';\nimport './App.css';\nimport Tray from '../Tray/Tray';\nimport CallObjectContext from '../../CallObjectContext';\nimport SessionStateContext from '../../SessionStateContext';\nimport MyContext from '../../MyContext'\nimport { roomUrlFromPageUrl, pageUrlFromRoomUrl } from '../../urlUtils';\nimport DailyIframe from '@daily-co/daily-js';\nimport { logDailyEvent } from '../../logUtils';\nimport setSubscriptions from '../../hooks/setSubscriptions';\nimport { sendState } from '../AdminPanel/AdminFunctions';\nimport audioPlayer from '../../hooks/AudioPlayer';\nimport AdminPanel from '../AdminPanel/AdminPanel';\n\n\n\n\nconst STATE_IDLE = 'STATE_IDLE';\nconst STATE_CREATING = 'STATE_CREATING';\nconst STATE_JOINING = 'STATE_JOINING';\nconst STATE_JOINED = 'STATE_JOINED';\nconst STATE_LEAVING = 'STATE_LEAVING';\nconst STATE_ERROR = 'STATE_ERROR';\n\n\n\n\nexport default function App() {\n  const [appState, setAppState] = useState(STATE_IDLE);\n  const [roomUrl, setRoomUrl] = useState(null);\n  const [callObject, setCallObject] = useState(null);\n  const [sessionState, setSessionState] = useState({\n                                                    type: 'sessionState',\n                                                    isKnown:false,\n                                                    isActive:false,\n                                                    AdminVisible:false,\n                                                    roleOf: {\n                                                              Buyer1: '',\n                                                              Buyer2: '',\n                                                              Buyer3: '',\n                                                              Seller: '',\n                                                              Shadow1: '',\n                                                              Shadow2: '',\n                                                              Shadow3: '',\n                                                              Shadow4: '',\n                                                            }\n                                                    });\n  const [my, setMy] = useState({\n                                name: 'Your first name',\n                                role: 'Attendee',\n                                adminStatus: false,\n                              });\n  const [ camDisabled, setCamDisabled ] = useState(false);\n  const [ micDisabled, setMicDisabled ] = useState(false);\n\n\n\n  if (!window.pass.includes(window.myP)) {\n    //redirect if password is wrong\n    window.location.href = \"http://secondbody.co\"\n  }\n\n  window.setViewMode = (viewMode) => {\n    viewMode && console.log ('Changing view mode to: ' + viewMode);\n    window.viewMode=viewMode;\n    setSubscriptions(callObject,viewMode)\n  }\n\n\n  \n  /**\n   * Creates a new call room.\n   */\n  const createCall = useCallback(() => {\n    setAppState(STATE_CREATING);\n    return api\n      .createRoom()\n      .then((room) => room.url)\n      .catch((error) => {\n        console.log('Error creating room', error);\n        setRoomUrl(null);\n        setAppState(STATE_IDLE);\n      });\n  }, []);\n\n\n\n  /**\n   * Starts joining an existing call.\n   *\n   * NOTE: In this demo we show how to completely clean up a call with destroy(),\n   * which requires creating a new call object before you can join() again.\n   * This isn't strictly necessary, but is good practice when you know you'll\n   * be done with the call object for a while and you're no longer listening to its\n   * events.\n   */\n\n\n/*   \nARLO NOTE:\n      Below is where the trouble is. myInfo.name is set via a child component, <StartScreen>, \n      and it successfully changes myInfo.name (I've confirmed since it's pinned to the Window).\n      The below works... the first time. But then callObject.participants().local.user_name gets \"stuck\", \n      so if you exit and leave, or even refresh the page, it never changes. Weird behavior\n*/\n\n  const startJoiningCall = useCallback((url) => {\n    // if(!initialInputs) {return}\n    const newCallObject = DailyIframe.createCallObject({ \n      subscribeToTracksAutomatically: false, \n    });\n    setRoomUrl(url);\n    setCallObject(newCallObject);\n    setAppState(STATE_JOINING);\n    if(window.initialInputs) {\n      console.log('initial audio: ' + window.initialInputs[0] + '. Initial video: ' + window.initialInputs[1])\n      newCallObject.join({ userName:window.myName, url, audioSource: window.initialInputs[0],videoSource:window.initialInputs[1]}); \n    } else {\n      navigator.mediaDevices.getUserMedia({audio:true,video:true}).then((mediaStream)=>{\n        if(mediaStream){\n          let localAudio = mediaStream.getAudioTracks();\n          let localVideo = mediaStream.getVideoTracks();\n          if(localAudio && localAudio.length > 0 && localVideo && localVideo.length > 0)\n              {\n                newCallObject.join({ userName:my.name, url, audioSource: localAudio[0], videoSource:localVideo[0]});\n              }\n        }else{\n          //say something to user, like you don't have any mic or you should allow use mic to this website\n        }\n      })\n    }\n    console.log('joining the call as ' + my.name); \n    const pageUrl = pageUrlFromRoomUrl(roomUrl)+'&N='+window.myName+'&R='+window.myRole;\n    // let connector = '?';\n    // if (pageUrl.includes('?roomUrl=')) {let connector = '&'};\n    // if (window.myName) {\n    //   if (pageUrl === window.location.href) return;\n    //   window.history.replaceState(null, null, pageUrl + connector + \"R=\" + window.myRole + \"&N=\" + window.myName);\n    // } else if (window.myRole) {\n    //   if (pageUrl === window.location.href) return;\n    //   window.history.replaceState(null, null, pageUrl + connector + \"R=\" + window.myRole);\n    // } else {\n    //   if (pageUrl === window.location.href) return;\n    //   window.history.replaceState(null, null, pageUrl);\n    // }\n  }, []); \n\n\n\n  /**\n   * Starts leaving the current call.\n   */\n  const startLeavingCall = useCallback(() => {\n    if (!callObject) return;\n    // If we're in the error state, we've already \"left\", so just clean up\n    if (appState === STATE_ERROR) {\n      callObject.destroy().then(() => {\n        setRoomUrl(null);\n        setCallObject(null);\n        setAppState(STATE_IDLE);\n        window.initialize();\n      });\n    } else {\n      setAppState(STATE_LEAVING);\n      callObject.leave();\n      window.initialize();    \n    }\n  }, [callObject, appState]);\n\n  /**\n   * If a room's already specified in the page's URL when the component mounts,\n   * join the room.\n   */\n  useEffect(() => {\n    const url = roomUrlFromPageUrl();\n    url && window.initialInputs && startJoiningCall(url);\n  }, [startJoiningCall]);\n\n  /**\n   * Update the page's URL to reflect the active call when roomUrl changes.\n   *\n   * This demo uses replaceState rather than pushState in order to avoid a bit\n   * of state-management complexity. See the comments around enableCallButtons\n   * and enableStartButton for more information.\n   */\n  useEffect(() => {\n    let pageUrl = pageUrlFromRoomUrl(roomUrl);\n    window.pageUrl=pageUrl;\n    \n    if (window.myName) {\n      if (pageUrl.indexOf('?') > -1){\n        pageUrl += '&N=' + window.myName;\n      }else{\n        pageUrl += '?N=' + window.myName;\n      }\n    }\n    if (window.myRole) {\n      if (pageUrl.indexOf('?') > -1){\n        pageUrl += '&R=' + window.myRole;\n      }else{\n        pageUrl += '?R=' + window.myRole;\n      }\n    }\n    if (window.myP) {\n      if (pageUrl.indexOf('?') > -1){\n        pageUrl += '&P=' + window.myP;\n      }else{\n        pageUrl += '?P=' + window.myP;\n      }\n    }\n    if (pageUrl === window.location.href) return;\n    window.history.replaceState(null, null, pageUrl);\n  }, [roomUrl]);\n\n\n  /**\n   * Uncomment to attach call object to window for debugging purposes.\n   */\n  useEffect(() => {\n    window.callObject = callObject;\n  }, [callObject]); // Only re-run the effect if callObject changes\n\n  \n function getState () {\n    if (window.sessionState.isKnown == true) {\n        clearInterval(window.stateRequest);            \n        return;\n    }\n    // if (window.adminPresent) {\n        callObject.sendAppMessage(\"State please?\", '*'); \n        console.log('Requesting meeting state...');\n    \n}\n\nconst checkIfAdminPresent = () => {\n\n  return new Promise((resolve) => {\n    window.adminPresent = false;\n    let ps=callObject.participants();\n    const lookForMoreParticipants = setInterval (()=>{  //This interval should be redundant, but checking to make sure a dummy user doesn't pop up first\n      if  (Object.keys(ps).length > 1\n            || (Object.keys(ps).length <= 1 && ps.local.user_name == window.myName)  \n      ) {\n            clearInterval(lookForMoreParticipants);\n            for (const p in ps) {\n              let thisUserName = ps[p].user_name;\n              if (thisUserName.includes('_Admin') && p!=='local') {\n                window.adminPresent = true;\n              }\n              console.log(`Participant present: ${thisUserName}`);\n            }\n            resolve ();\n      } else {return;}\n    },500)\n  })\n}\n \n\n  /**\n   * Update app state based on reported meeting state changes.\n   *\n   * NOTE: Here we're showing how to completely clean up a call with destroy().\n   * This isn't strictly necessary between join()s, but is good practice when\n   * you know you'll be done with the call object for a while and you're no\n   * longer listening to its events.\n   */\n  useEffect(() => {\n    if (!callObject) return;\n\n    const events = ['joined-meeting', 'left-meeting', 'error','participant-joined'];\n\n    function handleNewMeetingState(event) {\n      event && logDailyEvent(event);\n      switch (callObject.meetingState()) {\n        case 'joined-meeting':\n          setAppState(STATE_JOINED);\n          callObject.setNetworkTopology({ topology: 'sfu' });\n          window.userList.push(window.myName);\n          console.log('JOINED MEETING');\n          if(window.myName==\"\"){callObject.leave();}\n          if (!window.sessionState.isKnown) {\n            if (window.myRole==\"Admin\") {\n              checkIfAdminPresent().then(()=> {\n                window.sessionState.isKnown = window.adminPresent ? false : true;\n                window.adminPresent? console.log(`An admin is already present`) : console.log(`An admin is NOT already present`);\n                if (!window.sessionState.isKnown) {\n                  window.stateRequest = setInterval(()=>{getState()},2500);\n                }\n              })\n            } else {\n              window.stateRequest = setInterval(()=>{getState()},2500);\n            }\n          }\n          \n\n          break;\n        case 'left-meeting':\n          callObject.destroy().then(() => {\n            setRoomUrl(null);\n            setCallObject(null);\n            setAppState(STATE_IDLE);\n            clearInterval(window.stateRequest);\n            window.initialize();\n          });\n          break;\n        case 'participant-joined':\n\n          break;\n        case 'error':\n          setAppState(STATE_ERROR);\n          break;\n        default:\n          break;\n      }\n    }\n\n    // Use initial state\n    handleNewMeetingState();\n\n    // Listen for changes in state\n    for (const event of events) {\n      callObject.on(event, handleNewMeetingState);\n    }\n\n    // Stop listening for changes in state\n    return function cleanup() {\n      for (const event of events) {\n        callObject.off(event, handleNewMeetingState);\n      }\n    };\n  }, [callObject]);\n\n  /**\n   * Listen for app messages from other call participants.\n   */\n  useEffect(() => {\n    if (!callObject) {\n      return;\n    }\n\n    function handleAppMessage(e) {\n      if (e) {\n        logDailyEvent(e);\n        console.log(`received app message from ${e.fromId}: `, e.data);\n\n          let participants = callObject.participants();\n      \n          //handle sessionState updates\n          if (e.data.constructor === Object && e.data.type==\"sessionState\") {\n\n            const setSubs = () => {setSubscriptions(callObject)}\n                  \n            //temporarily commented out\n                  // if (e.data.isKnown==false)   //probably redundant. only use received sessionState if isKnown = true\n                  //     {return;}\n                  // else if (e.data.isKnown==true && typeof(stateRequest)!='undefined') {   //if state is known, stop asking for state\n                  //     clearInterval(stateRequest);\n                  // }\n      \n              let priorSessionState = window.sessionState;\n              window.sessionState=e.data;\n              setSessionState(e.data);\n              let needToSetSubs=false;\n                \n      \n                  // change my role if it has been updated in sessionState\n                  if (window.sessionState.roleOf!=priorSessionState.roleOf) \n                    {\n                      let myNewRole = 'Attendee'; //default, if no role assigned\n                      for (const key in window.sessionState.roleOf) {\n                          if(window.sessionState.roleOf[key]==window.myName) {\n                              myNewRole = key;\n                          }\n                      }\n                      if (myNewRole!=window.myRole) {\n                          window.myRole = myNewRole;\n                            if (window.myRole.includes('1')) {\n                                window.myNumber=1;\n                            } else if (window.myRole.includes('2')) {\n                                window.myNumber=2;\n                            }\n                        }\n                          if(window.sessionState.isActive){\n                              activateSession();  //rebuild UI for the newly assigned role, mid-session\n                          } \n                          needToSetSubs=true;\n                    }\n\n\n      \n                      //create or delete rooms according to assignments of Thirds\n                      // if (window.sessionState.roleOf.Room3A!='') {\n                      //     !$(\"#view-mode option[value=Room3\").length>0 && $(\"#view-mode\").append(\"<option value='Room3'>Room3</option>\");\n                      //   } else {\n                      //     $(\"#view-mode option[value=Room3\").remove();\n                      //   }\n      \n                      // if (window.sessionState.roleOf.Room4A!='') {\n                      //     !$(\"#view-mode option[value=Room4\").length>0 && $(\"#view-mode\").append(\"<option value='Room4'>Room4</option>\");\n                      //   } else {\n                      //     $(\"#view-mode option[value=Room4\").remove();\n                      //   }\n      \n                      // if (window.sessionState.roleOf.Room5A!='') {\n                      //     !$(\"#view-mode option[value=Room5\").length>0 && $(\"#view-mode\").append(\"<option value='Room5'>Room5</option>\");\n                      //   } else {\n                      //     $(\"#view-mode option[value=Room5\").remove();\n                      //   }\n                      \n                  //determine if need to reset subs\n                  if (priorSessionState.isActive !== window.sessionState.isActive ||\n                      priorSessionState.AdminVisible!==window.sessionState.AdminVisible ) \n                      {\n                          needToSetSubs = true;\n                      }\n      \n                  //now, reset subscriptions if necessary\n                  if (needToSetSubs) {\n                    if (!priorSessionState.isActive && window.sessionState.isActive && window.myRole=='Attendee' || window.myRole=='Admin') {\n                      setSubscriptions(callObject,'Room1')\n                    }\n                    else {\n                      setSubs();\n                    }\n                  }\n                  \n                  //when session starts\n                  if (priorSessionState.isActive == false && window.sessionState.isActive == true) {\n                      activateSession();\n                      //set ViewMode when session is started by self. \n                      if (window.myRole=='Attendee' || window.myRole=='Admin') {\n                        if (window.sessionState.roleOf.Shadow1)\n                          {window.setViewMode('Shadow1');}\n                        else if (window.sessionState.roleOf.Shadow2)    //fallbacks in case shadow1 is not assigned\n                          {window.setViewMode('Shadow2');}\n                        else if (window.sessionState.roleOf.Shadow3)\n                          {window.setViewMode('Shadow3');}\n                        else if (window.sessionState.roleOf.Shadow4)\n                          {window.setViewMode('Shadow4');}\n                        else if (window.sessionState.roleOf.Seller)\n                          {window.setViewMode('Seller');}\n                        window.camWasOn = callObject.participants().local.video ? true : false;\n                        window.micWasOn = callObject.participants().local.audio ? true : false;\n                        callObject.setLocalVideo(false);\n                        callObject.setLocalAudio(false);\n                        if (!window.amAdmin) {\n                          setCamDisabled(true);\n                          setMicDisabled(true);\n                        }\n                      }\n                  }\n                  //when session is paused\n                  else if (priorSessionState.isActive == true && window.sessionState.isActive == false) {\n                      pauseSession();\n                      setCamDisabled(false);\n                      setMicDisabled(false);\n                      window.setViewMode(null);\n                      if (window.camWasOn) {\n                        callObject.setLocalVideo(true);\n                      }\n                      if (window.micWasOn) {\n                        callObject.setLocalAudio(true);\n                      }\n                  } \n            }\n\n            else if (e.data.constructor === Object && e.data.type==\"instructions\" && e.data.recipient==callObject.participants().local.session_id) {\n              audioPlayer(e.data.target,e.data.action)\n            }\n\n\n            else if (e.data==\"State please?\") {\n              if (window.amAdmin && window.sessionState.isKnown) {\n                sendState(window.sessionState,callObject);\n              }\n            } \n          }\n          //not used in this module, since there's no timer\n          \n          // if none of the above, just overlay the message\n          // else if (e.data.constructor !== Object) {    \n          //     overlayMessage(e.data,10000);\n          // }\n\n          async function activateSession() {\n            switch (window.myRole) {\n                case 'Attendee':\n                    // $(\"#cam-instructions\").fadeOut(500);\n                    // $(\"#cam-image\").fadeOut(500);\n                    // $(\"#mic-instructions\").fadeOut(500);\n                    // $(\"#mic-image\").fadeOut(500);\n                    // $('#show-qr-code').fadeOut(500);\n                    // $('#get-prompt').fadeOut(500);\n                    // document.getElementById('my-view').style.visibility='visible';\n                    // $('#my-view').fadeIn(500);\n                    window.camWasOn = callObject.localVideo();\n                    if (window.camWasOn) {\n                        // toggleCam()\n                    }\n                    // $('#view-mode').val('Room1').trigger(\"change\");\n                    // document.getElementById(\"overlay\").className = \"superimposed-text-attendees\";\n                    // document.getElementById(\"overlay-text\").className = \"overlay-text-attendees\";\n                    break;\n        \n                case 'Participant1':\n                case 'Participant2':\n                    // $(\"#cam-instructions\").fadeIn(500);\n                    // $(\"#cam-image\").fadeIn(500);\n                    // $(\"#mic-instructions\").fadeIn(500);\n                    // $(\"#mic-image\").fadeIn(500);\n                    // $('#show-qr-code').fadeOut(500);\n                    // $('#get-prompt').fadeIn(500);\n                    // $('#my-view').fadeOut(500);\n                    // document.getElementById('my-view').style.visibility='hidden';\n                    // document.getElementById(\"overlay\").className = \"superimposed-text\";\n                    // document.getElementById(\"overlay-text\").className = \"overlay-text\";\n                    // displayName();\n                    // closeChat();\n                    break;\n        \n                case 'Actor1':\n                case 'Actor2':\n                case 'Room3A':\n                case 'Room3B':\n                case 'Room4A':\n                case 'Room4B':\n                case 'Room5A':\n                case 'Room5B':\n                    // $(\"#cam-instructions\").fadeIn(500);\n                    // $(\"#cam-image\").fadeIn(500);\n                    // $(\"#mic-instructions\").fadeIn(500);\n                    // $(\"#mic-image\").fadeIn(500);\n                    // $('#show-qr-code').fadeIn(500);\n                    // $('#get-prompt').fadeOut(500);\n                    // $('#my-view').fadeOut(500);\n                    // document.getElementById('my-view').style.visibility='hidden';\n                    // document.getElementById(\"overlay\").className = \"superimposed-text\";\n                    // document.getElementById(\"overlay-text\").className = \"overlay-text\";\n                    // displayName();\n                    // closeChat();\n                    break;\n                \n                default:\n                    break;\n            }\n        }\n          \n          async function pauseSession() {\n            // $(\"#cam-instructions\").fadeIn(500);\n            // $(\"#cam-image\").fadeIn(500);\n            // $(\"#mic-instructions\").fadeIn(500);\n            // $(\"#mic-image\").fadeIn(500);\n            // $('#show-qr-code').fadeIn(500);\n            // $('#get-prompt').fadeOut(500);\n            // document.getElementById('get-prompt').style.visibility='hidden';\n            // $('#my-view').fadeOut(500);\n            // if (window.camWasOn && !callObject.localVideo()) {toggleCam()}; // turn back on cam if it was noted as on before session\n          }\n\n\n      \n    } //end handleAppMessage\n\n    callObject.on('app-message', handleAppMessage);\n\n    return function cleanup() {\n      callObject.off('app-message', handleAppMessage);\n    };\n  }, [callObject]);\n\n  const updateSessionState = (newSessionState) => setSessionState(newSessionState);\n\n  /**\n   * Show the call UI if we're either joining, already joined, or are showing\n   * an error.\n   */\n  const showCall = [STATE_JOINING, STATE_JOINED, STATE_ERROR].includes(\n    appState\n  );\n\n  /**\n   * Only enable the call buttons (camera toggle, leave call, etc.) if we're joined\n   * or if we've errored out.\n   *\n   * !!!\n   * IMPORTANT: calling callObject.destroy() *before* we get the \"joined-meeting\"\n   * can result in unexpected behavior. Disabling the leave call button\n   * until then avoids this scenario.\n   * !!!\n   */\n  const enableCallButtons = [STATE_JOINED, STATE_ERROR].includes(appState);\n\n  /**\n   * Only enable the start button if we're in an idle state (i.e. not creating,\n   * joining, etc.).\n   *\n   * !!!\n   * IMPORTANT: only one call object is meant to be used at a time. Creating a\n   * new call object with DailyIframe.createCallObject() *before* your previous\n   * callObject.destroy() completely finishes can result in unexpected behavior.\n   * Disabling the start button until then avoids that scenario.\n   * !!!\n   */\n  const enableStartButton = appState === STATE_IDLE;\n\n  return (\n\n\n    <div className=\"app\">\n      <SessionStateContext.Provider \n      value={{session: [sessionState,setSessionState]}}\n      >\n        <MyContext.Provider \n        value={{myState: [my,setMy]}}\n        >\n\n        {(showCall) ? (\n          // NOTE: for an app this size, it's not obvious that using a Context\n          // is the best choice. But for larger apps with deeply-nested components\n          // that want to access call object state and bind event listeners to the\n          // call object, this can be a helpful pattern.\n          <CallObjectContext.Provider value={callObject}>\n\n            <Call roomUrl={roomUrl} />\n            <Tray\n              micDisabled={micDisabled}\n              camDisabled={camDisabled}\n              onClickLeaveCall={startLeavingCall}\n            />\n            {window.amAdmin && (\n          <AdminPanel\n        />\n        )}\n          </CallObjectContext.Provider>\n        ) : (\n          <StartScreen\n            // disabled={!enableStartButton}\n            onClick={() => {\n              createCall().then((url) => startJoiningCall(url));\n            }}\n          />\n        )}\n        </MyContext.Provider>\n      </SessionStateContext.Provider>\n    </div>\n\n\n  );\n}\n"]},"metadata":{},"sourceType":"module"}