{"ast":null,"code":"var _jsxFileName = \"/Users/arlosb/Documents/GitHub/new react app/test5/src/components/LivestormTest/Tray/Tray.js\";\nimport React, { useContext, useEffect, useRef, useState } from 'react';\nimport $ from 'jquery';\nimport './Tray.css';\nimport TrayButton, { TYPE_MUTE_CAMERA, TYPE_MUTE_MIC, TYPE_SCREEN, TYPE_LEAVE, TYPE_CHAT } from '../TrayButton/TrayButton';\nimport recordButton from \"./record.svg\";\nimport recordingButton from \"./recording.svg\";\nimport InputSelector from '../InputSelector/InputSelector';\nimport Chat from '../Chat/Chat';\nimport CallObjectContext from '../../../CallObjectContext';\nimport { logDailyEvent } from '../../../logUtils';\nimport DailyIframe from '@daily-co/daily-js';\nimport MyContext from '../../../MyContext';\nimport SessionStateContext from '../../../SessionStateContext';\nimport axios from 'axios';\n\nfunction useForceUpdate() {\n  const [value, setValue] = useState(0); // integer state\n\n  return () => setValue(value => value + 1); // update the state to force render\n}\n/**\n * Gets [isCameraMuted, isMicMuted, isSharingScreen].\n * This function is declared outside Tray() so it's not recreated every render\n * (which would require us to declare it as a useEffect dependency).\n */\n\n\nfunction getStreamStates(callObject) {\n  let isCameraMuted,\n      isMicMuted,\n      isSharingScreen,\n      isRecording = false;\n\n  if (callObject && callObject.participants() && callObject.participants().local) {\n    const localParticipant = callObject.participants().local;\n    isCameraMuted = !localParticipant.video;\n    isMicMuted = !localParticipant.audio;\n    isSharingScreen = localParticipant.screen;\n    isRecording = localParticipant.record;\n  }\n\n  return [isCameraMuted, isMicMuted, isSharingScreen, isRecording];\n}\n/**\n * Props:\n * - onClickLeaveCall: () => ()\n * - disabled: boolean\n */\n\n\nexport default function Tray(props) {\n  const callObject = useContext(CallObjectContext);\n  const {\n    session\n  } = useContext(SessionStateContext);\n  const [sessionState, setSessionState] = session;\n  const {\n    myStateArray,\n    setName,\n    setRole,\n    setUserList,\n    setViewMode,\n    setCamOnAtSessionStart,\n    setMicOnAtSessionStart,\n    setAmAdmin\n  } = useContext(MyContext);\n  const [myState, setMyState] = myStateArray;\n  const [isCameraMuted, setCameraMuted] = useState(false);\n  const [isMicMuted, setMicMuted] = useState(false);\n  const [isSharingScreen, setSharingScreen] = useState(false);\n  const [isRecording, setRecording] = useState(false);\n  const [displayChat, setChatDisplay] = useState(false);\n  const [highlightedChat, setChatHighlight] = useState(false);\n  const forceUpdate = useForceUpdate();\n  const micCaret = React.createRef();\n  const micSettings = React.createRef();\n  const camCaret = React.createRef();\n  const camSettings = React.createRef();\n  const recordingToggle = React.createRef();\n\n  window.updateTray = () => {\n    forceUpdate();\n  };\n\n  const [showMicSettings, setShowMicSettings] = useState(false);\n  const [showCamSettings, setShowCamSettings] = useState(false);\n\n  function toggleCamera() {\n    callObject.setLocalVideo(isCameraMuted);\n  }\n\n  function toggleMic() {\n    callObject.setLocalAudio(isMicMuted);\n  }\n\n  function screenAlreadyShared() {\n    let screenShareExists = false;\n    let ps = callObject.participants();\n\n    for (const p in ps) {\n      if (!!ps[p].screenVideoTrack) {\n        screenShareExists = true;\n      }\n\n      ;\n    }\n\n    return screenShareExists;\n  }\n\n  useEffect(() => {\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return function cleanup() {\n      document.removeEventListener(\"mousedown\", handleClickOutside);\n    };\n  });\n\n  const handleClickOutside = event => {\n    console.log('handling click');\n\n    if (micSettings.current && !micSettings.current.contains(event.target) && !micCaret.current.contains(event.target)) {\n      setShowMicSettings(false);\n    } else if (camSettings.current && !camSettings.current.contains(event.target) && !camCaret.current.contains(event.target)) {\n      setShowCamSettings(false);\n    }\n  };\n\n  function toggleSharingScreen() {\n    if (!isSharingScreen && screenAlreadyShared()) {\n      alert(`There is already a screenshare in progress`);\n      return;\n    }\n\n    isSharingScreen ? callObject.stopScreenShare() : callObject.startScreenShare();\n  }\n\n  function leaveCall() {\n    props.onClickLeaveCall && props.onClickLeaveCall();\n  }\n\n  async function uploadRecording() {\n    getRecordingData().then(data => sendToMux(data.data[0].share_token));\n\n    function getRecordingData() {\n      return new Promise((resolve, reject) => {\n        let isFinished = false;\n        const checkIfUploaded = setInterval(() => {\n          $.ajax({\n            url: \"https://api.daily.co/v1/recordings?room_name=Livestorm-testing&limit=1\",\n            beforeSend: function (xhr) {\n              xhr.setRequestHeader('Authorization', 'Bearer 54d0be1deb0e5ecfebf61207a47cf13689c18a2fd4a695a41b13622d61e5a756');\n            },\n            type: 'GET',\n            dataType: 'json',\n            contentType: 'application/json',\n            processData: false,\n            success: function (data) {\n              if (data.data[0].status === 'finished') {\n                isFinished = true;\n                resolve(data); // alert('got data');\n              } else {// alert('data is not ready yet'); ///error: loops if nothing recorded\n                }\n            }\n          });\n\n          if (isFinished) {\n            clearInterval(checkIfUploaded);\n          }\n        }, 2000);\n      });\n    }\n\n    async function sendToMux(dailyShareToken) {\n      let downloadLink = \"https://api.daily.co/v1/recordings/\" + dailyShareToken + \"/download\";\n      let data = {\n        input: downloadLink,\n        playback_policy: \"public\",\n        mp4_support: \"standard\"\n      };\n      const results = await axios.post('/.netlify/functions/uploadToMux', {\n        data: data\n      });\n      alert(results.data.message); // $.ajax({\n      //   url: \"https://api.mux.com/video/v1/assets\",\n      //   beforeSend: function(xhr) { \n      //     // xhr.setRequestHeader(\"Authorization\", \"Basic \" + btoa(\"768959a2-7b04-44c2-b584-5800ffc71297:7fB9Fa8rXoCKI3MNDloDusslbS6gwZMoHj6dZldFBNoFEhUTT/pr+c/aI+4S5kImvDtCrBkk14a\"));  //testing -- change also both places in AppLibrary.js\n      //     xhr.setRequestHeader(\"Authorization\", \"Basic \" + btoa(\"4100efdb-e648-4287-ad0a-50e9875a238b:TyiPEfPzEcz/tl/0sYh5ndPpNIwaom0mQaLRiDQ4E+pX1nH1Xl9XDJWXiPYtgx5QRfi/8ukakFh\"));  //livestorm\n      //     // xhr.setRequestHeader(\"Authorization\", \"Basic \" + btoa(process.env.REACT_APP_MUX_TOKEN_ID, process.env.REACT_APP_MUX_TOKEN_SECRET));  //no luck\n      //   },\n      //   type: 'POST',\n      //   dataType: 'json',\n      //   contentType: 'application/json',\n      //   processData: false,\n      //   data: JSON.stringify(data),\n      //   success: function (data) {\n      //     alert('Recording uploading...');\n      //   },\n      //   error: function(){\n      //     alert(\"There was a problem uploading your recording.\");\n      //   }\n      // });\n      // setTimeout(function(){\n      //   /// list recordings WORKS!\n      //   $.ajax({\n      //     url: \"https://api.mux.com/video/v1/assets\",\n      //     beforeSend: function(xhr) { \n      //       xhr.setRequestHeader(\"Authorization\", \"Basic \" + btoa(\"768959a2-7b04-44c2-b584-5800ffc71297:7fB9Fa8rXoCKI3MNDloDusslbS6gwZMoHj6dZldFBNoFEhUTT/pr+c/aI+4S5kImvDtCrBkk14a\")); \n      //     },\n      //     type: 'GET',\n      //     // dataType: 'json',\n      //     contentType: 'application/json',\n      //     // processData: false,\n      //     // data: JSON.stringify(data),\n      //     success: function (data) {\n      //       alert(JSON.stringify(data));\n      //     },\n      //     error: function(){\n      //       alert(\"Cannot get recordings\");\n      //     }\n      // });\n      // },5000) \n    }\n  }\n\n  window.uploadRecording = uploadRecording;\n\n  function toggleRecording() {\n    recordingToggle.current.src = isRecording ? recordButton : recordingButton;\n\n    if (isRecording) {\n      callObject.stopRecording();\n      uploadRecording();\n    } else {\n      callObject.startRecording();\n    }\n  }\n\n  function toggleChat() {\n    setChatDisplay(!displayChat);\n\n    if (highlightedChat) {\n      setChatHighlight(!highlightedChat);\n    }\n  }\n\n  function handleNewChat() {\n    setChatHighlight(!highlightedChat);\n  }\n\n  function openScreenShareWindow() {\n    window.open(\"http://\" + window.location.host + \"/share\", \"test\", \"width=300, height=300\");\n  }\n  /**\n  * Start listening for changes on sessionState, to turn cam + mic on and off\n  //  */\n\n\n  useEffect(() => {\n    if (sessionState.isActive) {\n      if (!myState.role.includes('Shadow') && !myState.role.includes('Seller') && !myState.role.includes('Buyer')) {\n        setMicOnAtSessionStart(callObject.localAudio()); //\"remember\" if cam + mic were on or off before session started\n\n        setCamOnAtSessionStart(callObject.localVideo());\n        callObject.setLocalAudio(false);\n        callObject.setLocalVideo(false);\n      }\n    } else if (!sessionState.isActive) {\n      !callObject.localAudio() && callObject.setLocalAudio(myState.micOnAtSessionStart);\n      !callObject.localVideo() && callObject.setLocalVideo(myState.camOnAtSessionStart);\n      setMicOnAtSessionStart(null);\n      setCamOnAtSessionStart(null);\n    }\n  }, [sessionState.isActive, myState.role]);\n  /**\n  * Turn mic on and off when \n  //  */\n\n  /**\n   * Start listening for participant changes when callObject is set (i.e. when the component mounts).\n   * This event will capture any changes to your audio/video mute state.\n   */\n\n  useEffect(() => {\n    if (!callObject) return;\n\n    function handleNewParticipantsState(event) {\n      event && logDailyEvent(event);\n      const [isCameraMuted, isMicMuted, isSharingScreen, isRecording] = getStreamStates(callObject);\n      setCameraMuted(isCameraMuted);\n      setMicMuted(isMicMuted);\n      setSharingScreen(isSharingScreen);\n      setRecording(isRecording);\n    } // Use initial state\n\n\n    handleNewParticipantsState(); // Listen for changes in state\n\n    callObject.on('participant-updated', handleNewParticipantsState); // Stop listening for changes in state\n\n    return function cleanup() {\n      callObject.off('participant-updated', handleNewParticipantsState);\n    };\n  }, [callObject]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: myState.amAdmin && myState.sidebar ? \"tray-with-sidebar\" : \"tray\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 346,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(TrayButton, {\n    type: TYPE_MUTE_CAMERA // disabled={props.camDisabled}\n    ,\n    highlighted: isCameraMuted,\n    onClick: toggleCamera,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 348,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    onClick: () => {\n      setShowCamSettings(!showCamSettings);\n    },\n    style: {\n      position: 'absolute',\n      left: '57px',\n      bottom: '23px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 356,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    className: \"caret\",\n    ref: camCaret,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 357,\n      columnNumber: 9\n    }\n  }, \"^\"), showCamSettings ? /*#__PURE__*/React.createElement(InputSelector, {\n    type: \"video\",\n    page: \"main\",\n    ref: camSettings,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 359,\n      columnNumber: 18\n    }\n  }) : null), /*#__PURE__*/React.createElement(TrayButton, {\n    type: TYPE_MUTE_MIC // disabled={props.micDisabled}\n    ,\n    highlighted: isMicMuted,\n    onClick: toggleMic,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 365,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    onClick: () => {\n      setShowMicSettings(!showMicSettings);\n    },\n    style: {\n      position: 'absolute',\n      left: '123px',\n      bottom: '23px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 372,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    className: \"caret\",\n    ref: micCaret,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 375,\n      columnNumber: 9\n    }\n  }, \"^\"), showMicSettings ? /*#__PURE__*/React.createElement(InputSelector, {\n    type: \"audio\",\n    page: \"main\",\n    ref: micSettings,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 377,\n      columnNumber: 18\n    }\n  }) : null), DailyIframe.supportedBrowser().supportsScreenShare && myState.amAdmin && /*#__PURE__*/React.createElement(TrayButton, {\n    type: TYPE_SCREEN // disabled={props.disabled}\n    ,\n    highlighted: isSharingScreen // onClick={openScreenShareWindow} //LIVESTORM PILOT CHANGE: deleted video share\n    ,\n    onClick: toggleSharingScreen //LIVESTORM PILOT CHANGE: added normal screenshare\n    ,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 385,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(TrayButton, {\n    type: TYPE_CHAT // disabled={props.disabled}\n    ,\n    highlighted: highlightedChat,\n    onClick: toggleChat,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 393,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Chat, {\n    onClickDisplay: displayChat,\n    notification: handleNewChat,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 399,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"status-display\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 406,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      height: '30px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 408,\n      columnNumber: 13\n    }\n  }, \"Roleplay:  \\xA0\", sessionState.isActive ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"display-card active\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 411,\n      columnNumber: 31\n    }\n  }, \"Live\") : /*#__PURE__*/React.createElement(\"div\", {\n    className: \"display-card paused\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 413,\n      columnNumber: 31\n    }\n  }, \"Paused\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"vertical-line\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 417,\n      columnNumber: 13\n    }\n  }), !sessionState.isActive || myState.role !== 'Admin' && myState.role !== 'Attendee' ? /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      height: '30px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 422,\n      columnNumber: 23\n    }\n  }, \"My Role: \\xA0\", myState.role == 'Admin' || myState.role == 'Attendee' ? /*#__PURE__*/React.createElement(\"span\", {\n    className: \"display-card role\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 426,\n      columnNumber: 31\n    }\n  }, \"Viewer\") : /*#__PURE__*/React.createElement(\"span\", {\n    className: \"display-card role\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 429,\n      columnNumber: 31\n    }\n  }, myState.role.match(/\\D/g).join(''))) : /*#__PURE__*/React.createElement(\"div\", {\n    className: \"my-view\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 436,\n      columnNumber: 17\n    }\n  }, \"My View: \\xA0\", /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 438,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(\"form\", {\n    action: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 439,\n      columnNumber: 31\n    }\n  }, /*#__PURE__*/React.createElement(\"fieldset\", {\n    style: {\n      border: 'none'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 440,\n      columnNumber: 33\n    }\n  }, /*#__PURE__*/React.createElement(\"select\", {\n    className: \"my-view-selector\",\n    value: myState.viewMode,\n    onChange: e => setViewMode(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 441,\n      columnNumber: 37\n    }\n  }, /*#__PURE__*/React.createElement(\"option\", {\n    value: \"Seller\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 442,\n      columnNumber: 41\n    }\n  }, \"Seller\"), sessionState.roleOf.Shadow1 && /*#__PURE__*/React.createElement(\"option\", {\n    value: \"Shadow1\",\n    selected: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 443,\n      columnNumber: 73\n    }\n  }, \"Shadow 1\"), sessionState.roleOf.Shadow2 && /*#__PURE__*/React.createElement(\"option\", {\n    value: \"Shadow2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 444,\n      columnNumber: 73\n    }\n  }, \"Shadow 2\"), sessionState.roleOf.Shadow3 && /*#__PURE__*/React.createElement(\"option\", {\n    value: \"Shadow3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 445,\n      columnNumber: 73\n    }\n  }, \"Shadow 3\"), sessionState.roleOf.Shadow4 && /*#__PURE__*/React.createElement(\"option\", {\n    value: \"Shadow4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 446,\n      columnNumber: 73\n    }\n  }, \"Shadow 4\"), sessionState.roleOf.Shadow5 && /*#__PURE__*/React.createElement(\"option\", {\n    value: \"Shadow5\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 447,\n      columnNumber: 73\n    }\n  }, \"Shadow 5\"), sessionState.roleOf.Shadow6 && /*#__PURE__*/React.createElement(\"option\", {\n    value: \"Shadow6\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 448,\n      columnNumber: 73\n    }\n  }, \"Shadow 6\"), sessionState.roleOf.Seller && sessionState.roleOf.Shadow1 && /*#__PURE__*/React.createElement(\"option\", {\n    value: \"All\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 449,\n      columnNumber: 103\n    }\n  }, \"All\"), sessionState.roleOf.Shadow1 || sessionState.roleOf.Shadow2 || sessionState.roleOf.Shadow3 || sessionState.roleOf.Shadow4 || sessionState.roleOf.Shadow5 || sessionState.roleOf.Shadow6 && /*#__PURE__*/React.createElement(\"option\", {\n    value: \"All\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 456,\n      columnNumber: 43\n    }\n  }, \"All\"))))))), /*#__PURE__*/React.createElement(\"img\", {\n    ref: recordingToggle,\n    src: recordButton,\n    onClick: toggleRecording,\n    width: 55,\n    height: 37,\n    className: \"recording-button\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 473,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(TrayButton, {\n    type: TYPE_LEAVE,\n    disabled: props.disabled,\n    newButtonGroup: false,\n    highlighted: true,\n    onClick: leaveCall,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 482,\n      columnNumber: 13\n    }\n  }));\n}","map":{"version":3,"sources":["/Users/arlosb/Documents/GitHub/new react app/test5/src/components/LivestormTest/Tray/Tray.js"],"names":["React","useContext","useEffect","useRef","useState","$","TrayButton","TYPE_MUTE_CAMERA","TYPE_MUTE_MIC","TYPE_SCREEN","TYPE_LEAVE","TYPE_CHAT","InputSelector","Chat","CallObjectContext","logDailyEvent","DailyIframe","MyContext","SessionStateContext","axios","useForceUpdate","value","setValue","getStreamStates","callObject","isCameraMuted","isMicMuted","isSharingScreen","isRecording","participants","local","localParticipant","video","audio","screen","record","Tray","props","session","sessionState","setSessionState","myStateArray","setName","setRole","setUserList","setViewMode","setCamOnAtSessionStart","setMicOnAtSessionStart","setAmAdmin","myState","setMyState","setCameraMuted","setMicMuted","setSharingScreen","setRecording","displayChat","setChatDisplay","highlightedChat","setChatHighlight","forceUpdate","micCaret","createRef","micSettings","camCaret","camSettings","recordingToggle","window","updateTray","showMicSettings","setShowMicSettings","showCamSettings","setShowCamSettings","toggleCamera","setLocalVideo","toggleMic","setLocalAudio","screenAlreadyShared","screenShareExists","ps","p","screenVideoTrack","document","addEventListener","handleClickOutside","cleanup","removeEventListener","event","console","log","current","contains","target","toggleSharingScreen","alert","stopScreenShare","startScreenShare","leaveCall","onClickLeaveCall","uploadRecording","getRecordingData","then","data","sendToMux","share_token","Promise","resolve","reject","isFinished","checkIfUploaded","setInterval","ajax","url","beforeSend","xhr","setRequestHeader","type","dataType","contentType","processData","success","status","clearInterval","dailyShareToken","downloadLink","input","playback_policy","mp4_support","results","post","message","toggleRecording","src","recordButton","recordingButton","stopRecording","startRecording","toggleChat","handleNewChat","openScreenShareWindow","open","location","host","isActive","role","includes","localAudio","localVideo","micOnAtSessionStart","camOnAtSessionStart","handleNewParticipantsState","on","off","amAdmin","sidebar","position","left","bottom","supportedBrowser","supportsScreenShare","height","match","join","border","viewMode","e","roleOf","Shadow1","Shadow2","Shadow3","Shadow4","Shadow5","Shadow6","Seller","disabled"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useRef, useState } from 'react';\nimport $ from 'jquery';\nimport './Tray.css';\nimport TrayButton, {\n  TYPE_MUTE_CAMERA,\n  TYPE_MUTE_MIC,\n  TYPE_SCREEN,\n  TYPE_LEAVE,\n  TYPE_CHAT,\n} from '../TrayButton/TrayButton';\nimport recordButton from './record.svg'\nimport recordingButton from './recording.svg'\nimport InputSelector from '../InputSelector/InputSelector';\nimport Chat from '../Chat/Chat';\nimport CallObjectContext from '../../../CallObjectContext';\nimport { logDailyEvent } from '../../../logUtils';\nimport DailyIframe from '@daily-co/daily-js';\nimport MyContext from '../../../MyContext';\nimport SessionStateContext from '../../../SessionStateContext';\nimport axios from 'axios'\nfunction useForceUpdate(){\n  const [value, setValue] = useState(0); // integer state\n  return () => setValue(value => value + 1); // update the state to force render\n}\n\n/**\n * Gets [isCameraMuted, isMicMuted, isSharingScreen].\n * This function is declared outside Tray() so it's not recreated every render\n * (which would require us to declare it as a useEffect dependency).\n */\nfunction getStreamStates(callObject) {\n  let isCameraMuted,\n    isMicMuted,\n    isSharingScreen,\n    isRecording = false;\n  if (\n    callObject &&\n    callObject.participants() &&\n    callObject.participants().local\n  ) {\n    const localParticipant = callObject.participants().local;\n    isCameraMuted = !localParticipant.video;\n    isMicMuted = !localParticipant.audio;\n    isSharingScreen = localParticipant.screen;\n    isRecording =  localParticipant.record;\n\n  }\n  return [isCameraMuted, isMicMuted, isSharingScreen, isRecording];\n}\n\n\n/**\n * Props:\n * - onClickLeaveCall: () => ()\n * - disabled: boolean\n */\nexport default function Tray(props) {\n  const callObject = useContext(CallObjectContext);\n  const { session } = useContext(SessionStateContext);\n  const [ sessionState,setSessionState] = session;\n  const { myStateArray, \n    setName, \n    setRole,\n    setUserList,\n    setViewMode,\n    setCamOnAtSessionStart,\n    setMicOnAtSessionStart,\n    setAmAdmin, \n  } = useContext(MyContext);\nconst [ myState,setMyState ] = myStateArray;\n  const [isCameraMuted, setCameraMuted] = useState(false);\n  const [isMicMuted, setMicMuted] = useState(false);\n  const [isSharingScreen, setSharingScreen] = useState(false);\n  const [isRecording, setRecording] = useState(false);\n  const [displayChat, setChatDisplay] = useState(false);\n  const [highlightedChat, setChatHighlight] = useState(false);\n  const forceUpdate = useForceUpdate();\n  const micCaret = React.createRef();\n  const micSettings = React.createRef();\n  const camCaret = React.createRef();\n  const camSettings = React.createRef();\n  const recordingToggle = React.createRef();\n\n  \n\n  window.updateTray = () => {\n    forceUpdate();\n  }\n\n  const [showMicSettings,setShowMicSettings] = useState(false);\n  const [showCamSettings,setShowCamSettings] = useState(false);\n\n\n  function toggleCamera() {\n    callObject.setLocalVideo(isCameraMuted);\n  }\n\n  function toggleMic() {\n    callObject.setLocalAudio(isMicMuted);\n  }\n\n  function screenAlreadyShared() {\n    let screenShareExists = false;\n    let ps = callObject.participants();\n    for (const p in ps) {\n      if(!!ps[p].screenVideoTrack) {screenShareExists=true};\n    }\n    return screenShareExists;\n  }\n  \n\n\n  useEffect(()=> {\n\n    document.addEventListener(\"mousedown\", handleClickOutside);\n\n\n return function cleanup() {\n    document.removeEventListener(\"mousedown\", handleClickOutside);\n    };\n  })\n\n  const handleClickOutside = (event) => {\n    console.log('handling click');\n    if (micSettings.current &&\n      !micSettings.current.contains(event.target) &&\n      !micCaret.current.contains(event.target)\n    ) {\n      setShowMicSettings(false);\n    } else if (camSettings.current &&\n      !camSettings.current.contains(event.target) &&\n      !camCaret.current.contains(event.target)\n    ) {\n      setShowCamSettings(false);\n    } \n    \n  }\n\n  function toggleSharingScreen() {\n    if(!isSharingScreen && screenAlreadyShared()) {\n      alert(`There is already a screenshare in progress`);\n      return;\n    }\n    isSharingScreen\n      ? callObject.stopScreenShare()\n      : callObject.startScreenShare();\n  }\n\n    \n\n  function leaveCall() {\n    props.onClickLeaveCall && props.onClickLeaveCall();\n  }\n\n\n  async function uploadRecording() {\n      getRecordingData().then(data => sendToMux(data.data[0].share_token));\n    \n\n      function getRecordingData() {\n        return new Promise((resolve, reject) => {\n\n          let isFinished = false;\n\n          const checkIfUploaded = setInterval(\n            ()=>{\n                    $.ajax({\n                      url: \"https://api.daily.co/v1/recordings?room_name=Livestorm-testing&limit=1\",\n                      beforeSend: function (xhr) {\n                        xhr.setRequestHeader('Authorization', 'Bearer 54d0be1deb0e5ecfebf61207a47cf13689c18a2fd4a695a41b13622d61e5a756');\n                      },\n                      type: 'GET',\n                      dataType: 'json',\n                      contentType: 'application/json',\n                      processData: false,\n                      success: function (data) {\n                        if (data.data[0].status==='finished') {\n                          isFinished=true;\n                          resolve(data);\n                          // alert('got data');\n                        } else {\n                          // alert('data is not ready yet'); ///error: loops if nothing recorded\n                        }\n                      },\n                    });\n\n                    if (isFinished) {\n                      clearInterval(checkIfUploaded);\n                    }\n\n                },2000)\n\n          \n        })\n      }\n\n      async function sendToMux(dailyShareToken) {\n        let downloadLink = \"https://api.daily.co/v1/recordings/\" + dailyShareToken + \"/download\";\n        let data = { input:  downloadLink, \n                    playback_policy: \"public\", \n                    mp4_support: \"standard\" \n                  };\n\n        const results = await axios.post('/.netlify/functions/uploadToMux',\n            {\n              data: data,\n            }\n          );\n        alert(results.data.message);\n\n        // $.ajax({\n        //   url: \"https://api.mux.com/video/v1/assets\",\n        //   beforeSend: function(xhr) { \n        //     // xhr.setRequestHeader(\"Authorization\", \"Basic \" + btoa(\"768959a2-7b04-44c2-b584-5800ffc71297:7fB9Fa8rXoCKI3MNDloDusslbS6gwZMoHj6dZldFBNoFEhUTT/pr+c/aI+4S5kImvDtCrBkk14a\"));  //testing -- change also both places in AppLibrary.js\n        //     xhr.setRequestHeader(\"Authorization\", \"Basic \" + btoa(\"4100efdb-e648-4287-ad0a-50e9875a238b:TyiPEfPzEcz/tl/0sYh5ndPpNIwaom0mQaLRiDQ4E+pX1nH1Xl9XDJWXiPYtgx5QRfi/8ukakFh\"));  //livestorm\n        //     // xhr.setRequestHeader(\"Authorization\", \"Basic \" + btoa(process.env.REACT_APP_MUX_TOKEN_ID, process.env.REACT_APP_MUX_TOKEN_SECRET));  //no luck\n\n\n        //   },\n        //   type: 'POST',\n        //   dataType: 'json',\n        //   contentType: 'application/json',\n        //   processData: false,\n        //   data: JSON.stringify(data),\n        //   success: function (data) {\n        //     alert('Recording uploading...');\n        //   },\n        //   error: function(){\n        //     alert(\"There was a problem uploading your recording.\");\n        //   }\n      // });\n\n\n      // setTimeout(function(){\n      //   /// list recordings WORKS!\n      //   $.ajax({\n      //     url: \"https://api.mux.com/video/v1/assets\",\n      //     beforeSend: function(xhr) { \n      //       xhr.setRequestHeader(\"Authorization\", \"Basic \" + btoa(\"768959a2-7b04-44c2-b584-5800ffc71297:7fB9Fa8rXoCKI3MNDloDusslbS6gwZMoHj6dZldFBNoFEhUTT/pr+c/aI+4S5kImvDtCrBkk14a\")); \n      //     },\n      //     type: 'GET',\n      //     // dataType: 'json',\n      //     contentType: 'application/json',\n      //     // processData: false,\n      //     // data: JSON.stringify(data),\n      //     success: function (data) {\n      //       alert(JSON.stringify(data));\n      //     },\n      //     error: function(){\n      //       alert(\"Cannot get recordings\");\n      //     }\n      // });\n      // },5000) \n        \n      }\n\n  }\n\n  window.uploadRecording=uploadRecording;\n\n\n\n  function toggleRecording() {\n    recordingToggle.current.src = isRecording ? recordButton : recordingButton;\n    if (isRecording) {\n      callObject.stopRecording();\n      uploadRecording();\n    } else {\n      callObject.startRecording();\n    }\n  }\n\n  function toggleChat() {\n    setChatDisplay(!displayChat);\n    if (highlightedChat) {\n      setChatHighlight(!highlightedChat);\n    }\n  }\n\n  function handleNewChat() {\n    setChatHighlight(!highlightedChat);\n  }\n\n  function openScreenShareWindow () {\n    window.open(\"http://\" + window.location.host + \"/share\",\"test\",\"width=300, height=300\");\n  }\n\n\n   /**\n   * Start listening for changes on sessionState, to turn cam + mic on and off\n  //  */\n  useEffect(()=> {\n   if (sessionState.isActive) {\n      if (!myState.role.includes('Shadow') && !myState.role.includes('Seller') && !myState.role.includes('Buyer')) {\n        setMicOnAtSessionStart(callObject.localAudio());   //\"remember\" if cam + mic were on or off before session started\n        setCamOnAtSessionStart(callObject.localVideo());\n        callObject.setLocalAudio(false);\n        callObject.setLocalVideo(false);\n      }\n   } else if (!sessionState.isActive) {\n        !callObject.localAudio() && callObject.setLocalAudio(myState.micOnAtSessionStart);\n        !callObject.localVideo() && callObject.setLocalVideo(myState.camOnAtSessionStart);\n        setMicOnAtSessionStart(null);\n        setCamOnAtSessionStart(null);\n   }\n\n  },[sessionState.isActive,myState.role]);\n\n    /**\n   * Turn mic on and off when \n  //  */\n\n  /**\n   * Start listening for participant changes when callObject is set (i.e. when the component mounts).\n   * This event will capture any changes to your audio/video mute state.\n   */\n  useEffect(() => {\n    if (!callObject) return;\n\n    function handleNewParticipantsState(event) {\n      event && logDailyEvent(event);\n      const [isCameraMuted, isMicMuted, isSharingScreen, isRecording] = getStreamStates(\n        callObject\n      );\n      setCameraMuted(isCameraMuted);\n      setMicMuted(isMicMuted);\n      setSharingScreen(isSharingScreen);\n      setRecording(isRecording);\n    }\n\n    // Use initial state\n    handleNewParticipantsState();\n\n    // Listen for changes in state\n    callObject.on('participant-updated', handleNewParticipantsState);\n\n    // Stop listening for changes in state\n    return function cleanup() {\n      callObject.off('participant-updated', handleNewParticipantsState);\n    };\n  }, [callObject]);\n\n\n\n  return (\n    <div className={myState.amAdmin && myState.sidebar ? \"tray-with-sidebar\" : \"tray\"}>\n\n      <TrayButton\n        type={TYPE_MUTE_CAMERA}\n        // disabled={props.camDisabled}\n        highlighted={isCameraMuted}\n        onClick={toggleCamera}\n      />\n      \n      {/* {!props.camDisabled && */}\n      <div onClick={()=>{setShowCamSettings(!showCamSettings)}}  style={{position:'absolute',left:'57px', bottom:'23px'}}>\n        <p className=\"caret\" ref={camCaret}>^</p>\n                {showCamSettings ? \n                (<InputSelector type='video' page='main' ref={camSettings}/>)\n                : \n                null}\n      </div>\n      {/* } */}\n      \n      <TrayButton\n        type={TYPE_MUTE_MIC}\n        // disabled={props.micDisabled}\n        highlighted={isMicMuted}\n        onClick={toggleMic}\n      />\n      {/* {!props.micDisabled && */}\n        <div onClick={()=>{setShowMicSettings(!showMicSettings)}}  style={{position:'absolute',left:'123px', bottom:'23px'}}>\n        \n\n        <p className=\"caret\" ref={micCaret}>^</p>\n                {showMicSettings ? \n                (<InputSelector type='audio' page='main' ref={micSettings}/>)\n                : \n                null}\n                \n        </div>\n      {/* } */}\n\n      {DailyIframe.supportedBrowser().supportsScreenShare && myState.amAdmin && (\n        <TrayButton\n          type={TYPE_SCREEN}\n          // disabled={props.disabled}\n          highlighted={isSharingScreen}\n          // onClick={openScreenShareWindow} //LIVESTORM PILOT CHANGE: deleted video share\n          onClick={toggleSharingScreen}      //LIVESTORM PILOT CHANGE: added normal screenshare\n        />\n      )}\n      <TrayButton\n        type={TYPE_CHAT}\n        // disabled={props.disabled}\n        highlighted={highlightedChat}\n        onClick={toggleChat}\n      />\n      <Chat onClickDisplay={displayChat} notification={handleNewChat} />\n      \n        \n\n\n\n      {/* Display room status and either my role or room selector +  */}\n          <div className='status-display'>\n\n            <div style={{height:'30px'}}>\n               Roleplay:  &nbsp;            \n                            {sessionState.isActive ? \n                              <div className='display-card active'>Live</div>\n                              :\n                              <div className='display-card paused'>Paused</div>\n                            }\n              </div>\n\n            <div className='vertical-line'></div>\n\n            {/* if session is paused or I have a role, display my role, otherwise show room selector */}\n            {!sessionState.isActive || (myState.role!=='Admin' && myState.role!=='Attendee')\n            \n                ?   ( <div style={{height:'30px'}}>\n                            My Role: &nbsp;\n                            {myState.role=='Admin' || myState.role=='Attendee' \n\n                            ? <span className='display-card role'> \n                                Viewer\n                              </span>\n                            : <span className='display-card role'> \n                                {myState.role.match(/\\D/g).join('')} \n                              </span>\n                            \n                            }\n                       </div>\n                    )\n            : ( <div className='my-view'>\n                        My View: &nbsp;\n                            <span > \n                              <form action = ''>\n                                <fieldset style={{border:'none'}}>\n                                    <select className='my-view-selector' value={myState.viewMode} onChange = {(e)=>setViewMode(e.target.value)}>\n                                        <option value = 'Seller'>Seller</option>\n                                        {sessionState.roleOf.Shadow1 && <option value = 'Shadow1' selected>Shadow 1</option>}\n                                        {sessionState.roleOf.Shadow2 && <option value = 'Shadow2'>Shadow 2</option>}\n                                        {sessionState.roleOf.Shadow3 && <option value = 'Shadow3'>Shadow 3</option>}\n                                        {sessionState.roleOf.Shadow4 && <option value = 'Shadow4'>Shadow 4</option>}\n                                        {sessionState.roleOf.Shadow5 && <option value = 'Shadow5'>Shadow 5</option>}\n                                        {sessionState.roleOf.Shadow6 && <option value = 'Shadow6'>Shadow 6</option>}\n                                        {sessionState.roleOf.Seller && sessionState.roleOf.Shadow1 && <option value = 'All'>All</option>}\n                                        {sessionState.roleOf.Shadow1 ||\n                                          sessionState.roleOf.Shadow2 ||\n                                          sessionState.roleOf.Shadow3 ||\n                                          sessionState.roleOf.Shadow4 ||\n                                          sessionState.roleOf.Shadow5 ||\n                                          sessionState.roleOf.Shadow6 &&\n                                          <option value = 'All'>All</option>}\n                                    </select>\n                                </fieldset>\n                              </form>\n                            </span>\n                  </div>\n              )\n            \n              \n            }\n                            \n          \n             \n\n\n          </div>\n\n          <img \n          ref={recordingToggle}\n          src={recordButton}\n          onClick={toggleRecording}\n          width={55}\n          height={37}\n          className='recording-button'\n          />\n\n            <TrayButton\n              type={TYPE_LEAVE}\n              disabled={props.disabled}\n              newButtonGroup={false}\n              highlighted={true}\n              onClick={leaveCall}\n            />\n\n      \n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}