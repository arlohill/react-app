{"ast":null,"code":"var _jsxFileName = \"/Users/arlosb/Documents/GitHub/new react app/test1/src/components/Call/Call.js\";\nimport React, { useEffect, useContext, useReducer, useCallback } from 'react';\nimport './Call.css';\nimport Tile from '../Tile/Tile';\nimport CallObjectContext from '../../CallObjectContext';\nimport MyInfoContext from '../../MyInfoContext';\nimport SessionContext from '../../SessionContext';\nimport CallMessage from '../CallMessage/CallMessage';\nimport { initialCallState, CLICK_ALLOW_TIMEOUT, PARTICIPANTS_CHANGE, CAM_OR_MIC_ERROR, FATAL_ERROR, callReducer, isLocal, isScreenShare, containsScreenShare, getMessage } from './callState';\nimport { logDailyEvent } from '../../logUtils';\nimport setSubscriptions from '../../hooks/setSubscriptions';\nexport default function Call() {\n  const callObject = useContext(CallObjectContext);\n  const [sessionState, setSessionState] = useContext(SessionContext);\n  const [myInfo, setMyInfo] = useContext(MyInfoContext);\n  const [callState, dispatch] = useReducer(callReducer, initialCallState);\n  let userList = [];\n  let adminPresent = false;\n  let currentSubs = [];\n  useEffect(() => {\n    window.setSubscriptions = setSubscriptions;\n    window.currentSubs = currentSubs;\n  }, []);\n  /**\n   * Start listening for participant changes, when the callObject is set.\n   */\n\n  useEffect(() => {\n    if (!callObject) return;\n    const events = ['participant-joined', 'participant-updated', 'participant-left'];\n\n    function handleNewParticipantsState(e) {\n      if (!e) {\n        return;\n      }\n\n      logDailyEvent(e);\n      console.log('got an app message:' + e);\n      dispatch({\n        type: PARTICIPANTS_CHANGE,\n        participants: callObject.participants()\n      });\n\n      if (e.action == 'app-message') {\n        console.log('***MADE IT HERE***');\n        receiveMessage(e);\n      } else if (e.action == 'participant-joined' || e.action == 'participant-left') {\n        setSubscriptions(sessionState, myInfo, callObject, currentSubs);\n        console.log(\"setting subscriptions because: \" + e.action);\n        let thisUserName = e.participant.user_name;\n        let thisSessionID = e.participant.session_id;\n\n        if (e.action == \"participant-joined\") {\n          let SessionIDLabel = thisUserName + \"_SessionID\";\n          window[SessionIDLabel] = thisSessionID;\n          userList.push(thisUserName); //Add userName to all the dropdowns\n          // $(\"#selectPersonP1\").append(\"<option value=\" + thisUserName + \">\" + thisUserName + \"</option>\");\n          // $(\"#selectPersonP2\").append(\"<option value=\" + thisUserName + \">\" + thisUserName + \"</option>\");\n          // $(\"#selectPersonA1\").append(\"<option value=\" + thisUserName + \">\" + thisUserName + \"</option>\");\n          // $(\"#selectPersonA2\").append(\"<option value=\" + thisUserName + \">\" + thisUserName + \"</option>\");\n          // $(\"#audio-target\").append(\"<option value=\" + thisUserName + \">\" + thisUserName + \"</option>\");\n          // $(\"#selectRoom3A\").append(\"<option value=\" + thisUserName + \">\" + thisUserName + \"</option>\");\n          // $(\"#selectRoom3B\").append(\"<option value=\" + thisUserName + \">\" + thisUserName + \"</option>\");\n          // $(\"#selectRoom4A\").append(\"<option value=\" + thisUserName + \">\" + thisUserName + \"</option>\");\n          // $(\"#selectRoom4B\").append(\"<option value=\" + thisUserName + \">\" + thisUserName + \"</option>\");\n          // $(\"#selectRoom5A\").append(\"<option value=\" + thisUserName + \">\" + thisUserName + \"</option>\");\n          // $(\"#selectRoom5B\").append(\"<option value=\" + thisUserName + \">\" + thisUserName + \"</option>\");\n\n          if (thisUserName == 'Admin') {\n            adminPresent = true;\n          }\n        } else if (e.action == \"participant-left\") {\n          //remove from userList\n          let index = userList.indexOf(thisUserName);\n\n          if (index > -1) {\n            userList.splice(index, 1);\n          }\n\n          if (userList.indexOf('Admin') == -1) {\n            adminPresent = false;\n          } //Delete userName from all the dropdowns\n          // $(\"#selectPersonP1 option[value=\" + thisUserName + \"]\").remove();\n          // $(\"#selectPersonP2 option[value=\" + thisUserName + \"]\").remove();\n          // $(\"#selectPersonA1 option[value=\" + thisUserName + \"]\").remove();\n          // $(\"#selectPersonA2 option[value=\" + thisUserName + \"]\").remove();\n          // $(\"#selectRoom3A option[value=\" + thisUserName + \"]\").remove();\n          // $(\"#selectRoom3B option[value=\" + thisUserName + \"]\").remove();\n          // $(\"#selectRoom4A option[value=\" + thisUserName + \"]\").remove();\n          // $(\"#selectRoom4B option[value=\" + thisUserName + \"]\").remove();\n          // $(\"#selectRoom5A option[value=\" + thisUserName + \"]\").remove();\n          // $(\"#selectRoom5B option[value=\" + thisUserName + \"]\").remove();\n          // $(\"#audio-target option[value=\" + thisUserName + \"]\").remove();\n\n        }\n\n        console.log('Admin present: ' + adminPresent);\n        console.log('UserList: ' + userList);\n      }\n    } // Use initial state\n\n\n    handleNewParticipantsState(); // Listen for changes in state\n\n    for (const event of events) {\n      callObject.on(event, handleNewParticipantsState);\n    } // Stop listening for changes in state\n\n\n    return function cleanup() {\n      for (const event of events) {\n        callObject.off(event, handleNewParticipantsState);\n      }\n    };\n  }, [callObject, sessionState]);\n  /**\n   * Start listening for call errors, when the callObject is set.\n   */\n\n  useEffect(() => {\n    if (!callObject) return;\n\n    function handleCameraErrorEvent(event) {\n      logDailyEvent(event);\n      dispatch({\n        type: CAM_OR_MIC_ERROR,\n        message: event && event.errorMsg && event.errorMsg.errorMsg || 'Unknown'\n      });\n    } // We're making an assumption here: there is no camera error when callObject\n    // is first assigned.\n\n\n    callObject.on('camera-error', handleCameraErrorEvent);\n    return function cleanup() {\n      callObject.off('camera-error', handleCameraErrorEvent);\n    };\n  }, [callObject]);\n  /**\n   * Start listening for fatal errors, when the callObject is set.\n   */\n\n  useEffect(() => {\n    if (!callObject) return;\n\n    function handleErrorEvent(e) {\n      logDailyEvent(e);\n      dispatch({\n        type: FATAL_ERROR,\n        message: e && e.errorMsg || 'Unknown'\n      });\n    } // We're making an assumption here: there is no error when callObject is\n    // first assigned.\n\n\n    callObject.on('error', handleErrorEvent);\n    return function cleanup() {\n      callObject.off('error', handleErrorEvent);\n    };\n  }, [callObject]);\n  /**\n   * Start a timer to show the \"click allow\" message, when the component mounts.\n   */\n\n  useEffect(() => {\n    const t = setTimeout(() => {\n      dispatch({\n        type: CLICK_ALLOW_TIMEOUT\n      });\n    }, 2500);\n    return function cleanup() {\n      clearTimeout(t);\n    };\n  }, []);\n  /**\n   * Handle incoming messages\n   */\n\n  const receiveMessage = e => {\n    console.log(\"Message received: \" + e.data);\n    let participants = callObject.participants(); //handle sessionState updates\n\n    if (e.data.constructor === Object && e.data.type == \"sessionState\") {\n      //temporarily commented out\n      // if (e.data.isKnown==false)   //probably redundant. only use received sessionState if isKnown = true\n      //     {return;}\n      // else if (e.data.isKnown==true && typeof(stateRequest)!='undefined') {   //if state is known, stop asking for state\n      //     clearInterval(stateRequest);\n      // }\n      let priorSessionState = sessionState;\n      setSessionState(e.data);\n      let needToSetSubs = false; //temporarily commented out\n      //change my role if it has been updated in sessionState\n      // if (sessionState.roleOf!=priorSessionState.roleOf) {\n      //     let myNewRole = 'Attendee'; //default, if no role assigned\n      //     for (const key in sessionState.roleOf) {\n      //         if(sessionState.roleOf[key]==myName) {\n      //             myNewRole = key;\n      //         }\n      //     }\n      //     if (myNewRole!=myRole) {\n      //         myRole = myNewRole;\n      //         setNumber();\n      //         if(sessionState.isActive){\n      //             needToSetSubs=true;\n      //             activateSession();  //rebuild UI for the newly assigned role, mid-session\n      //         } \n      //     }\n      //     //create or delete rooms according to assignments of Thirds\n      //     if (sessionState.roleOf.Room3A!='') {\n      //         !$(\"#view-mode option[value=Room3\").length>0 && $(\"#view-mode\").append(\"<option value='Room3'>Room3</option>\");\n      //       } else {\n      //         $(\"#view-mode option[value=Room3\").remove();\n      //       }\n      //     if (sessionState.roleOf.Room4A!='') {\n      //         !$(\"#view-mode option[value=Room4\").length>0 && $(\"#view-mode\").append(\"<option value='Room4'>Room4</option>\");\n      //       } else {\n      //         $(\"#view-mode option[value=Room4\").remove();\n      //       }\n      //     if (sessionState.roleOf.Room5A!='') {\n      //         !$(\"#view-mode option[value=Room5\").length>0 && $(\"#view-mode\").append(\"<option value='Room5'>Room5</option>\");\n      //       } else {\n      //         $(\"#view-mode option[value=Room5\").remove();\n      //       }\n      // }\n      // if (priorSessionState.isActive !== sessionState.isActive ||\n      //     priorSessionState.AdminVisible!==sessionState.AdminVisible ) \n      //     {\n      //         needToSetSubs = true;\n      //     }\n      // //now, reset subscriptions if necessary\n      // if (needToSetSubs) {\n      //     setSubscriptions();\n      // }\n      // //when session starts\n      // if (priorSessionState.isActive == false && sessionState.isActive == true) {\n      //     activateSession();\n      // }\n      // //when session is paused\n      // else if (priorSessionState.isActive == true && sessionState.isActive == false) {\n      //     pauseSession();\n      // }\n    } //not used in this module, since there's no timer\n    // if none of the above, just overlay the message\n    // else if (e.data.constructor !== Object) {    \n    //     overlayMessage(e.data,10000);\n    // }\n\n  };\n\n  function getTiles() {\n    let largeTiles = [];\n    let smallTiles = [];\n    Object.entries(callState.callItems).forEach(([id, callItem]) => {\n      const isLarge = isScreenShare(id) || !isLocal(id) && !containsScreenShare(callState.callItems) || isLocal(id) && Object.keys(callState.callItems).length >= 3 //////\n      ;\n      const tile = /*#__PURE__*/React.createElement(Tile, {\n        key: id,\n        videoTrackState: callItem.videoTrackState,\n        audioTrackState: callItem.audioTrackState,\n        isLocalPerson: isLocal(id),\n        isLarge: isLarge,\n        disableCornerMessage: isScreenShare(id),\n        isMyFirst: \"true\" // onClick={\n        //   isLocal(id)\n        //     ? null\n        //     : () => {\n        //         sendHello(id);\n        //       }\n        // }\n        ,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 304,\n          columnNumber: 9\n        }\n      });\n\n      if (isLarge) {\n        largeTiles.push(tile);\n      } else {\n        smallTiles.push(tile);\n      }\n    });\n    return [largeTiles, smallTiles];\n  }\n\n  const [largeTiles, smallTiles] = getTiles();\n  /**\n   * DELETE: Attached tiles objects to window for debugging purposes.\n   */\n\n  useEffect(() => {\n    console.log('re-rendered');\n    window.largeTiles = largeTiles;\n    window.smallTales = smallTiles;\n\n    window.add = function (n = 1) {\n      for (let i = 0; i < n; i++) {\n        callObject.addFakeParticipant();\n      }\n    };\n\n    window.userList = userList;\n    window.adminPresent = adminPresent;\n  }); // attach callState to window for debugging\n\n  useEffect(() => {\n    window.callState = callState;\n  }, [callState]);\n  const message = getMessage(callState);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"call\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 359,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: `large-tiles count-${largeTiles.length}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 361,\n      columnNumber: 7\n    }\n  }, !message ? largeTiles : null\n  /* Avoid showing large tiles to make room for the message */\n  ), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"small-tiles\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 368,\n      columnNumber: 7\n    }\n  }, smallTiles), message && /*#__PURE__*/React.createElement(CallMessage, {\n    header: message.header,\n    detail: message.detail,\n    isError: message.isError,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 370,\n      columnNumber: 9\n    }\n  }));\n}","map":{"version":3,"sources":["/Users/arlosb/Documents/GitHub/new react app/test1/src/components/Call/Call.js"],"names":["React","useEffect","useContext","useReducer","useCallback","Tile","CallObjectContext","MyInfoContext","SessionContext","CallMessage","initialCallState","CLICK_ALLOW_TIMEOUT","PARTICIPANTS_CHANGE","CAM_OR_MIC_ERROR","FATAL_ERROR","callReducer","isLocal","isScreenShare","containsScreenShare","getMessage","logDailyEvent","setSubscriptions","Call","callObject","sessionState","setSessionState","myInfo","setMyInfo","callState","dispatch","userList","adminPresent","currentSubs","window","events","handleNewParticipantsState","e","console","log","type","participants","action","receiveMessage","thisUserName","participant","user_name","thisSessionID","session_id","SessionIDLabel","push","index","indexOf","splice","event","on","cleanup","off","handleCameraErrorEvent","message","errorMsg","handleErrorEvent","t","setTimeout","clearTimeout","data","constructor","Object","priorSessionState","needToSetSubs","getTiles","largeTiles","smallTiles","entries","callItems","forEach","id","callItem","isLarge","keys","length","tile","videoTrackState","audioTrackState","smallTales","add","n","i","addFakeParticipant","header","detail","isError"],"mappings":"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","sourcesContent":["import React, { useEffect, useContext, useReducer, useCallback } from 'react';\nimport './Call.css';\nimport Tile from '../Tile/Tile';\nimport CallObjectContext from '../../CallObjectContext';\nimport MyInfoContext from '../../MyInfoContext';\nimport SessionContext from '../../SessionContext';\nimport CallMessage from '../CallMessage/CallMessage';\nimport {\n  initialCallState,\n  CLICK_ALLOW_TIMEOUT,\n  PARTICIPANTS_CHANGE,\n  CAM_OR_MIC_ERROR,\n  FATAL_ERROR,\n  callReducer,\n  isLocal,\n  isScreenShare,\n  containsScreenShare,\n  getMessage,\n} from './callState';\nimport { logDailyEvent } from '../../logUtils';\nimport setSubscriptions from '../../hooks/setSubscriptions';\n\n\nexport default function Call() {\n  const callObject = useContext(CallObjectContext);\n  const [ sessionState, setSessionState ] = useContext(SessionContext);\n  const [ myInfo, setMyInfo ] = useContext(MyInfoContext);\n  const [callState, dispatch] = useReducer(callReducer, initialCallState);\n  let userList=[];\n  let adminPresent=false;\n  let currentSubs= [];\n\n  useEffect(()=> {\n    window.setSubscriptions=setSubscriptions;\n    window.currentSubs=currentSubs;\n  },[])\n\n  /**\n   * Start listening for participant changes, when the callObject is set.\n   */\n  useEffect(() => {\n    if (!callObject) return;\n\n    const events = [\n      'participant-joined',\n      'participant-updated',\n      'participant-left',\n    ];\n\n   \n\n    function handleNewParticipantsState(e) {\n      if (!e) {return;}\n      logDailyEvent(e);\n      console.log('got an app message:' + e);\n      dispatch({\n        type: PARTICIPANTS_CHANGE,\n        participants: callObject.participants(),\n      });\n      if(e.action=='app-message') {\n        console.log('***MADE IT HERE***');\n        receiveMessage(e);\n      }\n      else if(e.action=='participant-joined' || e.action=='participant-left') {\n        setSubscriptions(sessionState,myInfo,callObject,currentSubs);\n        console.log(\"setting subscriptions because: \" + e.action);\n    \n          \n          let thisUserName = e.participant.user_name;\n          let thisSessionID = e.participant.session_id;\n          if (e.action==\"participant-joined\") {\n            let SessionIDLabel = thisUserName + \"_SessionID\";\n            window[SessionIDLabel] = thisSessionID;\n\n              userList.push(thisUserName);\n              //Add userName to all the dropdowns\n              // $(\"#selectPersonP1\").append(\"<option value=\" + thisUserName + \">\" + thisUserName + \"</option>\");\n              // $(\"#selectPersonP2\").append(\"<option value=\" + thisUserName + \">\" + thisUserName + \"</option>\");\n              // $(\"#selectPersonA1\").append(\"<option value=\" + thisUserName + \">\" + thisUserName + \"</option>\");\n              // $(\"#selectPersonA2\").append(\"<option value=\" + thisUserName + \">\" + thisUserName + \"</option>\");\n              // $(\"#audio-target\").append(\"<option value=\" + thisUserName + \">\" + thisUserName + \"</option>\");\n              // $(\"#selectRoom3A\").append(\"<option value=\" + thisUserName + \">\" + thisUserName + \"</option>\");\n              // $(\"#selectRoom3B\").append(\"<option value=\" + thisUserName + \">\" + thisUserName + \"</option>\");\n              // $(\"#selectRoom4A\").append(\"<option value=\" + thisUserName + \">\" + thisUserName + \"</option>\");\n              // $(\"#selectRoom4B\").append(\"<option value=\" + thisUserName + \">\" + thisUserName + \"</option>\");\n              // $(\"#selectRoom5A\").append(\"<option value=\" + thisUserName + \">\" + thisUserName + \"</option>\");\n              // $(\"#selectRoom5B\").append(\"<option value=\" + thisUserName + \">\" + thisUserName + \"</option>\");\n\n            if (thisUserName=='Admin') {\n                adminPresent=true;\n            }\n            \n          } else if (e.action==\"participant-left\") {\n            //remove from userList\n            let index = userList.indexOf(thisUserName);\n            if (index > -1) {\n            userList.splice(index, 1);\n            }\n            if (userList.indexOf('Admin')==-1) {\n              adminPresent=false;\n            }\n            //Delete userName from all the dropdowns\n            // $(\"#selectPersonP1 option[value=\" + thisUserName + \"]\").remove();\n            // $(\"#selectPersonP2 option[value=\" + thisUserName + \"]\").remove();\n            // $(\"#selectPersonA1 option[value=\" + thisUserName + \"]\").remove();\n            // $(\"#selectPersonA2 option[value=\" + thisUserName + \"]\").remove();\n            // $(\"#selectRoom3A option[value=\" + thisUserName + \"]\").remove();\n            // $(\"#selectRoom3B option[value=\" + thisUserName + \"]\").remove();\n            // $(\"#selectRoom4A option[value=\" + thisUserName + \"]\").remove();\n            // $(\"#selectRoom4B option[value=\" + thisUserName + \"]\").remove();\n            // $(\"#selectRoom5A option[value=\" + thisUserName + \"]\").remove();\n            // $(\"#selectRoom5B option[value=\" + thisUserName + \"]\").remove();\n            // $(\"#audio-target option[value=\" + thisUserName + \"]\").remove();\n          }\n\n          console.log('Admin present: ' + adminPresent);\n          console.log('UserList: ' + userList);\n      }\n      \n    }\n\n    // Use initial state\n    handleNewParticipantsState();\n\n    // Listen for changes in state\n    for (const event of events) {\n      callObject.on(event, handleNewParticipantsState);\n    }\n\n    // Stop listening for changes in state\n    return function cleanup() {\n      for (const event of events) {\n        callObject.off(event, handleNewParticipantsState);\n      }\n    };\n  }, [callObject,sessionState]);\n\n  /**\n   * Start listening for call errors, when the callObject is set.\n   */\n  useEffect(() => {\n    if (!callObject) return;\n\n    function handleCameraErrorEvent(event) {\n      logDailyEvent(event);\n      dispatch({\n        type: CAM_OR_MIC_ERROR,\n        message:\n          (event && event.errorMsg && event.errorMsg.errorMsg) || 'Unknown',\n      });\n    }\n\n    // We're making an assumption here: there is no camera error when callObject\n    // is first assigned.\n\n    callObject.on('camera-error', handleCameraErrorEvent);\n\n    return function cleanup() {\n      callObject.off('camera-error', handleCameraErrorEvent);\n    };\n  }, [callObject]);\n\n  /**\n   * Start listening for fatal errors, when the callObject is set.\n   */\n  useEffect(() => {\n    if (!callObject) return;\n\n    function handleErrorEvent(e) {\n      logDailyEvent(e);\n      dispatch({\n        type: FATAL_ERROR,\n        message: (e && e.errorMsg) || 'Unknown',\n      });\n    }\n\n    // We're making an assumption here: there is no error when callObject is\n    // first assigned.\n\n    callObject.on('error', handleErrorEvent);\n\n    return function cleanup() {\n      callObject.off('error', handleErrorEvent);\n    };\n  }, [callObject]);\n\n  /**\n   * Start a timer to show the \"click allow\" message, when the component mounts.\n   */\n  useEffect(() => {\n    const t = setTimeout(() => {\n      dispatch({ type: CLICK_ALLOW_TIMEOUT });\n    }, 2500);\n\n    return function cleanup() {\n      clearTimeout(t);\n    };\n  }, []);\n\n  /**\n   * Handle incoming messages\n   */\n   const receiveMessage = (e) => {\n    console.log(\"Message received: \" + e.data);\n    let participants = callObject.participants();\n\n    //handle sessionState updates\n    if (e.data.constructor === Object && e.data.type==\"sessionState\") {\n            \n      //temporarily commented out\n            // if (e.data.isKnown==false)   //probably redundant. only use received sessionState if isKnown = true\n            //     {return;}\n            // else if (e.data.isKnown==true && typeof(stateRequest)!='undefined') {   //if state is known, stop asking for state\n            //     clearInterval(stateRequest);\n            // }\n\n            let priorSessionState = sessionState;\n            setSessionState(e.data);\n            let needToSetSubs=false;\n          \n                  //temporarily commented out\n\n            //change my role if it has been updated in sessionState\n            // if (sessionState.roleOf!=priorSessionState.roleOf) {\n            //     let myNewRole = 'Attendee'; //default, if no role assigned\n            //     for (const key in sessionState.roleOf) {\n            //         if(sessionState.roleOf[key]==myName) {\n            //             myNewRole = key;\n            //         }\n            //     }\n            //     if (myNewRole!=myRole) {\n            //         myRole = myNewRole;\n            //         setNumber();\n            //         if(sessionState.isActive){\n            //             needToSetSubs=true;\n            //             activateSession();  //rebuild UI for the newly assigned role, mid-session\n            //         } \n            //     }\n\n            //     //create or delete rooms according to assignments of Thirds\n\n            //     if (sessionState.roleOf.Room3A!='') {\n            //         !$(\"#view-mode option[value=Room3\").length>0 && $(\"#view-mode\").append(\"<option value='Room3'>Room3</option>\");\n            //       } else {\n            //         $(\"#view-mode option[value=Room3\").remove();\n            //       }\n\n            //     if (sessionState.roleOf.Room4A!='') {\n            //         !$(\"#view-mode option[value=Room4\").length>0 && $(\"#view-mode\").append(\"<option value='Room4'>Room4</option>\");\n            //       } else {\n            //         $(\"#view-mode option[value=Room4\").remove();\n            //       }\n\n            //     if (sessionState.roleOf.Room5A!='') {\n            //         !$(\"#view-mode option[value=Room5\").length>0 && $(\"#view-mode\").append(\"<option value='Room5'>Room5</option>\");\n            //       } else {\n            //         $(\"#view-mode option[value=Room5\").remove();\n            //       }\n                \n\n\n            // }\n            \n            // if (priorSessionState.isActive !== sessionState.isActive ||\n            //     priorSessionState.AdminVisible!==sessionState.AdminVisible ) \n            //     {\n            //         needToSetSubs = true;\n            //     }\n\n            // //now, reset subscriptions if necessary\n            // if (needToSetSubs) {\n            //     setSubscriptions();\n            // }\n            \n            // //when session starts\n            // if (priorSessionState.isActive == false && sessionState.isActive == true) {\n            //     activateSession();\n            // }\n            // //when session is paused\n            // else if (priorSessionState.isActive == true && sessionState.isActive == false) {\n            //     pauseSession();\n            // }\n\n    \n    } \n    //not used in this module, since there's no timer\n    \n    // if none of the above, just overlay the message\n    // else if (e.data.constructor !== Object) {    \n    //     overlayMessage(e.data,10000);\n    // }\n}\n\n  function getTiles() {\n    let largeTiles = [];\n    let smallTiles = [];\n    Object.entries(callState.callItems).forEach(([id, callItem]) => {\n      const isLarge =\n        isScreenShare(id) ||\n        (!isLocal(id) && !containsScreenShare(callState.callItems) \n        || isLocal(id) && Object.keys(callState.callItems).length>=3  //////\n        );\n      const tile = (\n        <Tile\n          key={id}\n          videoTrackState={callItem.videoTrackState}\n          audioTrackState={callItem.audioTrackState}\n          isLocalPerson={isLocal(id)}\n          isLarge={isLarge}\n          disableCornerMessage={isScreenShare(id)}\n          isMyFirst='true'\n          // onClick={\n          //   isLocal(id)\n          //     ? null\n          //     : () => {\n          //         sendHello(id);\n          //       }\n          // }\n        />\n      );\n      if (isLarge) {\n        largeTiles.push(tile);\n      } else {\n        smallTiles.push(tile);\n      }\n    });\n    \n    return [largeTiles, smallTiles];\n  }\n\n  const [largeTiles, smallTiles] = getTiles();\n\n  \n  /**\n   * DELETE: Attached tiles objects to window for debugging purposes.\n   */\n  useEffect(() => {\n    console.log('re-rendered');\n    window.largeTiles = largeTiles;\n    window.smallTales = smallTiles;\n    window.add = function(n=1) {\n      for(let i=0;i<n;i++) {\n        callObject.addFakeParticipant()\n      }\n    };\n    window.userList=userList;\n    window.adminPresent=adminPresent;\n  }); \n\n\n   // attach callState to window for debugging\n   useEffect(() => {\n    window.callState = callState;\n  }, [callState]); \n\n\n  const message = getMessage(callState);\n  return (\n    <div className=\"call\">\n                                      {/* add # of tiles to class name */}\n      <div className={`large-tiles count-${largeTiles.length}`}>   \n        {\n          !message\n            ? largeTiles\n            : null /* Avoid showing large tiles to make room for the message */\n        }\n      </div>\n      <div className=\"small-tiles\">{smallTiles}</div>\n      {message && (\n        <CallMessage\n          header={message.header}\n          detail={message.detail}\n          isError={message.isError}\n        />\n      )}\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}