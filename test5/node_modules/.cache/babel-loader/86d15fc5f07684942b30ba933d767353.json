{"ast":null,"code":"import _slicedToArray from\"/Users/arlosb/Documents/GitHub/new react app/test5/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useMemo,useRef,useState}from'react';import'./Tile.css';function useForceUpdate(){var _useState=useState(0),_useState2=_slicedToArray(_useState,2),value=_useState2[0],setValue=_useState2[1];// integer state\nreturn function(){return setValue(function(value){return value+1;});};// update the state to force render\n}function getTrackUnavailableMessage(kind,trackState){if(!trackState)return;switch(trackState.state){case'blocked':if(trackState.blocked.byPermissions){return\"\".concat(kind,\" permission denied\");}else if(trackState.blocked.byDeviceMissing){return\"\".concat(kind,\" device missing\");}return\"\".concat(kind,\" blocked\");case'off':if(trackState.off.byUser){return\"\".concat(kind,\" muted\");}else if(trackState.off.byBandwidth){return\"\".concat(kind,\" muted to save bandwidth\");}return\"\".concat(kind,\" off\");case'sendable':return\"\".concat(kind,\" not subscribed\");case'loading':return\"\".concat(kind,\" loading...\");case'interrupted':return\"\".concat(kind,\" interrupted\");case'playable':return null;}}/**\n * Props\n * - videoTrackState: DailyTrackState?\n * - audioTrackState: DailyTrackState?\n * - isLocalPerson: boolean\n * - isAudioOnly: boolean\n * - isLarge: boolean\n * - disableCornerMessage: boolean\n * - onClick: Function\n * -isScreenShare: boolean\n */export default function Tile(props){var videoEl=useRef(null);var audioEl=useRef(null);var forceUpdate=useForceUpdate();window.updateTile=function(){forceUpdate();};var videoTrack=useMemo(function(){return props.videoTrackState&&props.videoTrackState.state==='playable'&&(props.isLocalPerson||props.videoTrackState.subscribed===true)?props.videoTrackState.track:null;},[props.videoTrackState]);var audioTrack=useMemo(function(){if(!props.audioTrackState||!props.audioTrackState.track||props.audioTrackState.state!=='playable'||props.audioTrackState.subscribed===false){return null;}// if(props.disableCornerMessage) {console.log('Is a screen share');}\nif(props.isAudioOnly){props.audioTrackState.track.isFiltered=true;}else{props.audioTrackState.track.isFiltered=false;}if(props.isScreenShare){props.audioTrackState.track.isScreenShare=true;}else{props.audioTrackState.track.isScreenShare=false;}return props.audioTrackState.track;},[props.audioTrackState]);var videoUnavailableMessage=useMemo(function(){return getTrackUnavailableMessage('video',props.videoTrackState);},[props.videoTrackState]);var audioUnavailableMessage=useMemo(function(){return getTrackUnavailableMessage('audio',props.audioTrackState);},[props.audioTrackState]);/**\n   * When video track changes, update video srcObject\n   */useEffect(function(){videoEl.current&&(videoEl.current.srcObject=new MediaStream([videoTrack]));},[videoTrack]);/**\n   * When audio track changes, update audio srcObject\n   */useEffect(function(){if(audioEl.current){///////////////TODO START TEMP DELETED PORTION\n// if(audioTrack.isFiltered) {\n//   console.log('**FILTERING LIVE TRACK**')\n//     ///******audiocontext creation section///\n//     //create audio stream\n//     window.stream= new MediaStream([audioTrack]);\n//     //workaround for bug in Chrome, see: https://bit.ly/3ryn1fW\n//           window.mutedAudio = window.mutedAudio || new Audio(); \n//           window.mutedAudio.muted = true;\n//           if(!window.mutedAudio.srcObject) {window.mutedAudio.srcObject = window.stream;}\n//           window.mutedAudio.paused && window.mutedAudio.play(); \n//     //create Audio Context and destination\n//     window.audioCtx = window.audioCtx || new (window.AudioContext || window.webkitAudioContext)();\n//    window.audioSourceNode = window.audioCtx.createMediaStreamSource(window.stream);\n//     if (typeof(window.destination)=='undefined'){window.destination = window.audioCtx.createMediaStreamDestination();}\n//     //gain Node\n//     if (typeof(window.gainNode)=='undefined') {window.gainNode = window.audioCtx.createGain();}\n//     //panner Node\n//     if (typeof(window.panNode)=='undefined') {window.panNode = window.audioCtx.createStereoPanner()}\n//     //*****end audiocontext creation section\n//         //adjust nodes\n//         window.gainNode.gain.value=1;\n//         window.panNode.pan.value=1;      \n//         //Pipe source through nodes to destination\n//       window.audioSourceNode.connect(window.gainNode).connect(window.panNode).connect(window.destination);\n//       //Attach to the audio element\n//     audioEl.current.srcObject = window.destination.stream;\n// } \n// else if(audioTrack.isScreenShare) {\n//   //for everyone, just piping the received audio (which was the left channel of the original video) straight through\n//   console.log('***GETTING SCREENSHARE AUDIO')\n//   ///***With audiocontext:  */\n//   // window.audioSourceNode.connect(destination);\n//   ///without Audiocontext:////\n//   audioEl.current.srcObject = new MediaStream([audioTrack]);\n// }\n// else {      //For normal live tracks\n//   console.log('***NOT FILTERING: LIVE TRACK***')\n//    //Pipe source *straight* to destination, through audiocontext\n//   // window.audioSourceNode.connect(gainNode).connect(destination);\n//   //without audiocontext\n//   audioEl.current.srcObject = new MediaStream([audioTrack]);\n// }\n///END TODO TEMP DELETED PORTION\n//when above is deleted:\naudioEl.current.srcObject=new MediaStream([audioTrack]);// for debugging\n// window.destination=destination; \n// window.audioTrack=audioTrack;\n// window.audioEl = audioEl;\n}},[audioTrack,window.sessionState]);function getVideoComponent(){return videoTrack&&/*#__PURE__*/React.createElement(\"video\",{autoPlay:true,muted:true,playsInline:true,ref:videoEl});}function getAudioComponent(){return!props.isLocalPerson&&audioTrack&&/*#__PURE__*/React.createElement(\"audio\",{autoPlay:true,playsInline:true,ref:audioEl},\" \");}function getOverlayComponent(){// Show overlay when video is unavailable. Audio may be unavailable too.\nreturn videoTrack&&videoUnavailableMessage&&/*#__PURE__*/React.createElement(\"p\",{className:\"overlay\"},videoUnavailableMessage);}function getCornerMessageComponent(){// Show corner message when only audio is unavailable.\nreturn!props.disableCornerMessage&&audioUnavailableMessage&&!videoUnavailableMessage&&/*#__PURE__*/React.createElement(\"p\",{className:\"corner\"},audioUnavailableMessage);}function getClassNames(){var classNames='tile';classNames+=props.isLarge?' large':' small';props.isLocalPerson&&(classNames+=' local');return classNames;}return/*#__PURE__*/ (///TODO change to block : none\nReact.createElement(\"div\",{className:getClassNames(),onClick:props.onClick,style:{display:videoTrack?\"block\":\"none\"}},/*#__PURE__*/React.createElement(\"div\",{className:\"background\"}),getOverlayComponent(),getVideoComponent(),videoTrack&&getCornerMessageComponent(),getAudioComponent()));}","map":null,"metadata":{},"sourceType":"module"}