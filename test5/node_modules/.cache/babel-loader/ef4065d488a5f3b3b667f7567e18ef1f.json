{"ast":null,"code":"import _createForOfIteratorHelper from\"/Users/arlosb/Documents/GitHub/new react app/test4/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _slicedToArray from\"/Users/arlosb/Documents/GitHub/new react app/test4/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useContext}from\"react\";import SessionStateContext from'../SessionStateContext';import MyContext from'../MyContext';import CallObjectContext from'../CallObjectContext';function useSetSubscriptions(){var callObject=useContext(CallObjectContext);var _useContext=useContext(SessionStateContext),session=_useContext.session;var _session=_slicedToArray(session,2),sessionState=_session[0],setSessionState=_session[1];var _useContext2=useContext(MyContext),myStateArray=_useContext2.myStateArray;var _myStateArray=_slicedToArray(myStateArray,2),myState=_myStateArray[0],setMyState=_myStateArray[1];useEffect(function(){var myRole=myState.role;var currentSubs=[];var viewMode=myState.viewMode;if(!sessionState){return;}///disable 'viewMode' unless session is active and I'm a viewer\nif(!sessionState.isActive||myRole.includes('Seller')||myRole.includes('Buyer')||myRole.includes('Shadow')){viewMode=null;}console.log('Setting subscriptions...');// console.log('****My role is: ' + myRole);\n// console.log('viewMode is: ' + viewMode);\nvar subscribedTo=0;//if session is active, set currentSubs according to my role\nif(!viewMode&&sessionState.isActive){switch(myRole){case'Buyer1':currentSubs=[];sessionState.roleOf.Shadow1&&currentSubs.push(sessionState.roleOf.Shadow1);// see shadow1 if there is a shadow1\n!sessionState.roleOf.Shadow1&&sessionState.roleOf.Seller&&currentSubs.push(sessionState.roleOf.Seller);//otherwise, see the original seller\nsessionState.roleOf.Buyer2&&currentSubs.push(sessionState.roleOf.Buyer2);sessionState.roleOf.Buyer3&&currentSubs.push(sessionState.roleOf.Buyer3);sessionState.roleOf.Buyer4&&currentSubs.push(sessionState.roleOf.Buyer4);break;case'Buyer2':currentSubs=[];sessionState.roleOf.Shadow1&&currentSubs.push(sessionState.roleOf.Shadow1);// see shadow1 if there is a shadow1\n!sessionState.roleOf.Shadow1&&sessionState.roleOf.Seller&&currentSubs.push(sessionState.roleOf.Seller);//otherwise, see the original seller\nsessionState.roleOf.Buyer1&&currentSubs.push(sessionState.roleOf.Buyer1);sessionState.roleOf.Buyer3&&currentSubs.push(sessionState.roleOf.Buyer3);sessionState.roleOf.Buyer4&&currentSubs.push(sessionState.roleOf.Buyer4);break;case'Buyer3':currentSubs=[];sessionState.roleOf.Shadow1&&currentSubs.push(sessionState.roleOf.Shadow1);// see shadow1 if there is a shadow1\n!sessionState.roleOf.Shadow1&&sessionState.roleOf.Seller&&currentSubs.push(sessionState.roleOf.Seller);//otherwise, see the original seller\nsessionState.roleOf.Buyer1&&currentSubs.push(sessionState.roleOf.Buyer1);sessionState.roleOf.Buyer2&&currentSubs.push(sessionState.roleOf.Buyer2);sessionState.roleOf.Buyer4&&currentSubs.push(sessionState.roleOf.Buyer4);break;case'Buyer4':currentSubs=[];sessionState.roleOf.Shadow1&&currentSubs.push(sessionState.roleOf.Shadow1);// see shadow1 if there is a shadow1\n!sessionState.roleOf.Shadow1&&sessionState.roleOf.Seller&&currentSubs.push(sessionState.roleOf.Seller);//otherwise, see the original seller\nsessionState.roleOf.Buyer1&&currentSubs.push(sessionState.roleOf.Buyer1);sessionState.roleOf.Buyer2&&currentSubs.push(sessionState.roleOf.Buyer2);sessionState.roleOf.Buyer3&&currentSubs.push(sessionState.roleOf.Buyer3);break;case'Seller':currentSubs=[];sessionState.roleOf.Buyer1&&currentSubs.push(sessionState.roleOf.Buyer1);sessionState.roleOf.Buyer2&&currentSubs.push(sessionState.roleOf.Buyer2);sessionState.roleOf.Buyer3&&currentSubs.push(sessionState.roleOf.Buyer3);sessionState.roleOf.Buyer4&&currentSubs.push(sessionState.roleOf.Buyer4);break;case'Shadow1':case'Shadow2':case'Shadow3':case'Shadow4':currentSubs=[];sessionState.roleOf.Buyer1&&currentSubs.push(sessionState.roleOf.Buyer1);sessionState.roleOf.Buyer2&&currentSubs.push(sessionState.roleOf.Buyer2);sessionState.roleOf.Buyer3&&currentSubs.push(sessionState.roleOf.Buyer3);sessionState.roleOf.Buyer4&&currentSubs.push(sessionState.roleOf.Buyer4);sessionState.roleOf.Seller&&currentSubs.push(sessionState.roleOf.Seller+'_AUDIO');break;case'Attendee':currentSubs=[];break;default:currentSubs=[];break;}//Add Admin to currentSubs if applicable\nif(sessionState.AdminVisible){currentSubs.push(\"Admin\");}currentSubs.filter(function(str){return str.indexOf(myState.name)===-1;});//don't include self\n}if(viewMode){switch(viewMode){case'Seller':currentSubs=[];sessionState.roleOf.Seller&&currentSubs.push(sessionState.roleOf.Seller);sessionState.roleOf.Buyer1&&currentSubs.push(sessionState.roleOf.Buyer1);sessionState.roleOf.Buyer2&&currentSubs.push(sessionState.roleOf.Buyer2);sessionState.roleOf.Buyer3&&currentSubs.push(sessionState.roleOf.Buyer3);sessionState.roleOf.Buyer4&&currentSubs.push(sessionState.roleOf.Buyer4);break;case'Shadow1':currentSubs=[];sessionState.roleOf.Shadow1&&currentSubs.push(sessionState.roleOf.Shadow1);sessionState.roleOf.Buyer1&&currentSubs.push(sessionState.roleOf.Buyer1);sessionState.roleOf.Buyer2&&currentSubs.push(sessionState.roleOf.Buyer2);sessionState.roleOf.Buyer3&&currentSubs.push(sessionState.roleOf.Buyer3);sessionState.roleOf.Buyer4&&currentSubs.push(sessionState.roleOf.Buyer4);break;case'Shadow2':currentSubs=[];sessionState.roleOf.Shadow2&&currentSubs.push(sessionState.roleOf.Shadow2);sessionState.roleOf.Buyer1&&currentSubs.push(sessionState.roleOf.Buyer1);sessionState.roleOf.Buyer2&&currentSubs.push(sessionState.roleOf.Buyer2);sessionState.roleOf.Buyer3&&currentSubs.push(sessionState.roleOf.Buyer3);break;case'Shadow3':sessionState.roleOf.Shadow3&&currentSubs.push(sessionState.roleOf.Shadow3);sessionState.roleOf.Buyer1&&currentSubs.push(sessionState.roleOf.Buyer1);sessionState.roleOf.Buyer2&&currentSubs.push(sessionState.roleOf.Buyer2);sessionState.roleOf.Buyer3&&currentSubs.push(sessionState.roleOf.Buyer3);sessionState.roleOf.Buyer4&&currentSubs.push(sessionState.roleOf.Buyer4);break;case'Shadow4':currentSubs=[];sessionState.roleOf.Shadow4&&currentSubs.push(sessionState.roleOf.Shadow4);sessionState.roleOf.Buyer1&&currentSubs.push(sessionState.roleOf.Buyer1);sessionState.roleOf.Buyer2&&currentSubs.push(sessionState.roleOf.Buyer2);sessionState.roleOf.Buyer3&&currentSubs.push(sessionState.roleOf.Buyer3);sessionState.roleOf.Buyer4&&currentSubs.push(sessionState.roleOf.Buyer4);break;case'All':currentSubs=[];sessionState.roleOf.Seller&&currentSubs.push(sessionState.roleOf.Seller);sessionState.roleOf.Shadow1&&currentSubs.push(sessionState.roleOf.Shadow1);sessionState.roleOf.Shadow2&&currentSubs.push(sessionState.roleOf.Shadow2);sessionState.roleOf.Shadow3&&currentSubs.push(sessionState.roleOf.Shadow3);sessionState.roleOf.Shadow4&&currentSubs.push(sessionState.roleOf.Shadow4);sessionState.roleOf.Buyer1&&currentSubs.push(sessionState.roleOf.Buyer1);sessionState.roleOf.Buyer2&&currentSubs.push(sessionState.roleOf.Buyer2);sessionState.roleOf.Buyer3&&currentSubs.push(sessionState.roleOf.Buyer3);sessionState.roleOf.Buyer4&&currentSubs.push(sessionState.roleOf.Buyer4);break;default:currentSubs=[];break;}currentSubs.filter(function(str){return str.indexOf(myState.name)===-1;});//don't include self\n}function setTracks(){return new Promise(function(resolve){//cycle through each participant in meeting\nvar ps=callObject.participants();// console.log('The second participant is named: ' + Object.values(ps)[1].user_name);\nObject.keys(ps).forEach(function(p){var participant=ps[p];var thisUserName=participant.user_name;if(p==='local'||thisUserName==myState.name){return;}//if SESSION STATE NOT KNOWN, don't subscribe to anyone yet\nif(!sessionState.isKnown){callObject.updateParticipant(participant.session_id,{setSubscribedTracks:false});return;}// console.log(\"This username is: \" +thisUserName);\n//If NOT ACTIVE, subscribe to everyone in the meeting\nif(!sessionState.isActive){if(thisUserName=='InvisibleScreenShareWidget'){console.log('Not subscribing to: '+thisUserName);callObject.updateParticipant(participant.session_id,{setSubscribedTracks:{audio:false,video:false,screenVideo:true,screenAudio:true}});}else{console.log('Subscribing to: '+thisUserName);currentSubs.push(thisUserName);// if (!callObject.participants()[participant.session_id].tracks.video.subscribed){ \n//     callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : false});  \n// }\ncallObject.updateParticipant(participant.session_id,{setSubscribedTracks:true});subscribedTo++;}// }\n}//IF ACTIVE (or selecting viewmode), just subscribe to those listed in currentSubs;\nelse if(sessionState.isActive||viewMode){if(currentSubs.includes(thisUserName+'_AUDIO')){console.log('Subscribing to audio only for: '+thisUserName);callObject.updateParticipant(participant.session_id,{setSubscribedTracks:{audio:true,video:false,screenVideo:false}});}else if(currentSubs.includes(thisUserName)){console.log('Subscribing to: '+thisUserName);callObject.updateParticipant(participant.session_id,{setSubscribedTracks:true});subscribedTo++;}else if(!currentSubs.includes(thisUserName)){console.log('NOT subscribing to: '+thisUserName+', sessionID: '+participant.session_id);callObject.updateParticipant(participant.session_id,{setSubscribedTracks:false});}}});resolve();});}setTracks().then(function(){//remove screenshare widget from currentSubs array to not count it\nvar index=currentSubs.indexOf('InvisibleScreenShareWidget');if(index>-1){currentSubs.splice(index,1);}//print subscriptions\ncurrentSubs.filter(function(str){return str.indexOf(window.myName)===-1;});//don't include self\nvar iterator=currentSubs.values();console.log(\"Currently subscribed to:\");var _iterator=_createForOfIteratorHelper(iterator),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var elements=_step.value;console.log(elements);}}catch(err){_iterator.e(err);}finally{_iterator.f();}if(currentSubs.length<1){console.log(\"No one.\");}///*** for debugging purposes\nwindow.viewMode=viewMode;window.currentSubs=currentSubs;window.numberOfSubs=window.currentSubs&&window.currentSubs.filter(function(str){return str.indexOf('_AUDIO')===-1;}).filter(function(str){return str.indexOf('_AUDIO')===-1;}).filter(function(str){return str.indexOf(window.myName)===-1;}).length;});},[sessionState,myState,callObject]);};export default useSetSubscriptions;","map":{"version":3,"sources":["/Users/arlosb/Documents/GitHub/new react app/test4/src/hooks/setSubscriptions.js"],"names":["useEffect","useContext","SessionStateContext","MyContext","CallObjectContext","useSetSubscriptions","callObject","session","sessionState","setSessionState","myStateArray","myState","setMyState","myRole","role","currentSubs","viewMode","isActive","includes","console","log","subscribedTo","roleOf","Shadow1","push","Seller","Buyer2","Buyer3","Buyer4","Buyer1","AdminVisible","filter","str","indexOf","name","Shadow2","Shadow3","Shadow4","setTracks","Promise","resolve","ps","participants","Object","keys","forEach","p","participant","thisUserName","user_name","isKnown","updateParticipant","session_id","setSubscribedTracks","audio","video","screenVideo","screenAudio","then","index","splice","window","myName","iterator","values","elements","length","numberOfSubs"],"mappings":"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","sourcesContent":["import { useEffect, useContext } from \"react\";\nimport SessionStateContext from '../SessionStateContext';\nimport MyContext from '../MyContext';\nimport CallObjectContext from '../CallObjectContext'\n\n\nfunction useSetSubscriptions() {\n\n    const callObject = useContext(CallObjectContext);\n    const { session } = useContext(SessionStateContext);\n    const [ sessionState,setSessionState] = session;    \n    const { myStateArray, \n        // setName, \n        // setRole,\n        // setUserList,\n        // setViewMode,\n        // setCamOnAtSessionStart,\n        // setMicOnAtSessionStart,\n        // setAmAdmin, \n      } = useContext(MyContext);\n    const [ myState,setMyState ] = myStateArray;\n\n\n    useEffect(()=> {\n\n        const myRole = myState.role;\n        let currentSubs = [];\n        let viewMode = myState.viewMode;\n    \n        if (!sessionState) {return;}\n    \n        ///disable 'viewMode' unless session is active and I'm a viewer\n        if(!sessionState.isActive || myRole.includes('Seller') || myRole.includes('Buyer') || myRole.includes('Shadow')) {\n            viewMode = null;\n        }\n    \n    \n        console.log('Setting subscriptions...');\n        // console.log('****My role is: ' + myRole);\n        // console.log('viewMode is: ' + viewMode);\n        let subscribedTo=0;\n    \n        \n        //if session is active, set currentSubs according to my role\n            if (!viewMode && sessionState.isActive) {\n                switch (myRole) {\n                    case 'Buyer1':\n                        currentSubs=[];\n                        sessionState.roleOf.Shadow1 && currentSubs.push(sessionState.roleOf.Shadow1); // see shadow1 if there is a shadow1\n                        !sessionState.roleOf.Shadow1 && sessionState.roleOf.Seller && currentSubs.push(sessionState.roleOf.Seller); //otherwise, see the original seller\n                        sessionState.roleOf.Buyer2 && currentSubs.push(sessionState.roleOf.Buyer2);\n                        sessionState.roleOf.Buyer3 && currentSubs.push(sessionState.roleOf.Buyer3);\n                        sessionState.roleOf.Buyer4 && currentSubs.push(sessionState.roleOf.Buyer4);\n\n                        break;\n                    case 'Buyer2':\n                        currentSubs=[];\n                        sessionState.roleOf.Shadow1 && currentSubs.push(sessionState.roleOf.Shadow1); // see shadow1 if there is a shadow1\n                        !sessionState.roleOf.Shadow1 && sessionState.roleOf.Seller && currentSubs.push(sessionState.roleOf.Seller); //otherwise, see the original seller\n                        sessionState.roleOf.Buyer1 && currentSubs.push(sessionState.roleOf.Buyer1);\n                        sessionState.roleOf.Buyer3 && currentSubs.push(sessionState.roleOf.Buyer3);\n                        sessionState.roleOf.Buyer4 && currentSubs.push(sessionState.roleOf.Buyer4);\n\n                        break;\n                    case 'Buyer3':\n                        currentSubs=[];\n                        sessionState.roleOf.Shadow1 && currentSubs.push(sessionState.roleOf.Shadow1); // see shadow1 if there is a shadow1\n                        !sessionState.roleOf.Shadow1 && sessionState.roleOf.Seller && currentSubs.push(sessionState.roleOf.Seller); //otherwise, see the original seller\n                        sessionState.roleOf.Buyer1 && currentSubs.push(sessionState.roleOf.Buyer1);\n                        sessionState.roleOf.Buyer2 && currentSubs.push(sessionState.roleOf.Buyer2);\n                        sessionState.roleOf.Buyer4 && currentSubs.push(sessionState.roleOf.Buyer4);\n\n                        break;\n                    case 'Buyer4':\n                        currentSubs=[];\n                        sessionState.roleOf.Shadow1 && currentSubs.push(sessionState.roleOf.Shadow1); // see shadow1 if there is a shadow1\n                        !sessionState.roleOf.Shadow1 && sessionState.roleOf.Seller && currentSubs.push(sessionState.roleOf.Seller); //otherwise, see the original seller\n                        sessionState.roleOf.Buyer1 && currentSubs.push(sessionState.roleOf.Buyer1);\n                        sessionState.roleOf.Buyer2 && currentSubs.push(sessionState.roleOf.Buyer2);\n                        sessionState.roleOf.Buyer3 && currentSubs.push(sessionState.roleOf.Buyer3);\n                        break;\n                    case 'Seller':\n                        currentSubs=[];\n                        sessionState.roleOf.Buyer1 && currentSubs.push(sessionState.roleOf.Buyer1);\n                        sessionState.roleOf.Buyer2 && currentSubs.push(sessionState.roleOf.Buyer2);\n                        sessionState.roleOf.Buyer3 && currentSubs.push(sessionState.roleOf.Buyer3);\n                        sessionState.roleOf.Buyer4 && currentSubs.push(sessionState.roleOf.Buyer4);\n\n                        break;\n                    case 'Shadow1':\n                    case 'Shadow2':\n                    case 'Shadow3':\n                    case 'Shadow4':\n                        currentSubs=[];\n                        sessionState.roleOf.Buyer1 && currentSubs.push(sessionState.roleOf.Buyer1);\n                        sessionState.roleOf.Buyer2 && currentSubs.push(sessionState.roleOf.Buyer2);\n                        sessionState.roleOf.Buyer3 && currentSubs.push(sessionState.roleOf.Buyer3);\n                        sessionState.roleOf.Buyer4 && currentSubs.push(sessionState.roleOf.Buyer4);\n                        sessionState.roleOf.Seller && currentSubs.push(sessionState.roleOf.Seller+'_AUDIO');\n                        break;\n                    case 'Attendee':\n                        currentSubs=[];\n                        break;\n                    default:\n                        currentSubs=[];\n                        break;\n                }\n                //Add Admin to currentSubs if applicable\n                if (sessionState.AdminVisible) {\n                currentSubs.push (\"Admin\");\n            }\n    \n            currentSubs.filter(function (str) {return str.indexOf(myState.name) === -1}) //don't include self\n    \n        }\n    \n        if(viewMode) {\n    \n            switch (viewMode) {\n                case 'Seller':\n                    currentSubs=[];\n                    sessionState.roleOf.Seller && currentSubs.push(sessionState.roleOf.Seller);\n                    sessionState.roleOf.Buyer1 && currentSubs.push(sessionState.roleOf.Buyer1);\n                    sessionState.roleOf.Buyer2 && currentSubs.push(sessionState.roleOf.Buyer2);\n                    sessionState.roleOf.Buyer3 && currentSubs.push(sessionState.roleOf.Buyer3);\n                    sessionState.roleOf.Buyer4 && currentSubs.push(sessionState.roleOf.Buyer4);\n\n                    break;\n                case 'Shadow1':\n                    currentSubs=[];\n                    sessionState.roleOf.Shadow1 && currentSubs.push(sessionState.roleOf.Shadow1);\n                    sessionState.roleOf.Buyer1 && currentSubs.push(sessionState.roleOf.Buyer1);\n                    sessionState.roleOf.Buyer2 && currentSubs.push(sessionState.roleOf.Buyer2);\n                    sessionState.roleOf.Buyer3 && currentSubs.push(sessionState.roleOf.Buyer3);\n                    sessionState.roleOf.Buyer4 && currentSubs.push(sessionState.roleOf.Buyer4);\n\n                    break;\n                case 'Shadow2':\n                    currentSubs=[];\n                    sessionState.roleOf.Shadow2 && currentSubs.push(sessionState.roleOf.Shadow2);\n                    sessionState.roleOf.Buyer1 && currentSubs.push(sessionState.roleOf.Buyer1);\n                    sessionState.roleOf.Buyer2 && currentSubs.push(sessionState.roleOf.Buyer2);\n                    sessionState.roleOf.Buyer3 && currentSubs.push(sessionState.roleOf.Buyer3);\n                    break;\n                case 'Shadow3':\n                    sessionState.roleOf.Shadow3 && currentSubs.push(sessionState.roleOf.Shadow3);\n                    sessionState.roleOf.Buyer1 && currentSubs.push(sessionState.roleOf.Buyer1);\n                    sessionState.roleOf.Buyer2 && currentSubs.push(sessionState.roleOf.Buyer2);\n                    sessionState.roleOf.Buyer3 && currentSubs.push(sessionState.roleOf.Buyer3);\n                    sessionState.roleOf.Buyer4 && currentSubs.push(sessionState.roleOf.Buyer4);\n\n                    break;\n                case 'Shadow4':\n                    currentSubs=[];\n                    sessionState.roleOf.Shadow4 && currentSubs.push(sessionState.roleOf.Shadow4);\n                    sessionState.roleOf.Buyer1 && currentSubs.push(sessionState.roleOf.Buyer1);\n                    sessionState.roleOf.Buyer2 && currentSubs.push(sessionState.roleOf.Buyer2);\n                    sessionState.roleOf.Buyer3 && currentSubs.push(sessionState.roleOf.Buyer3);\n                    sessionState.roleOf.Buyer4 && currentSubs.push(sessionState.roleOf.Buyer4);\n\n                    break;\n                case 'All':\n                    currentSubs=[];\n                    sessionState.roleOf.Seller && currentSubs.push(sessionState.roleOf.Seller);\n                    sessionState.roleOf.Shadow1 && currentSubs.push(sessionState.roleOf.Shadow1);\n                    sessionState.roleOf.Shadow2 && currentSubs.push(sessionState.roleOf.Shadow2);\n                    sessionState.roleOf.Shadow3 && currentSubs.push(sessionState.roleOf.Shadow3);\n                    sessionState.roleOf.Shadow4 && currentSubs.push(sessionState.roleOf.Shadow4);\n                    sessionState.roleOf.Buyer1 && currentSubs.push(sessionState.roleOf.Buyer1);\n                    sessionState.roleOf.Buyer2 && currentSubs.push(sessionState.roleOf.Buyer2);\n                    sessionState.roleOf.Buyer3 && currentSubs.push(sessionState.roleOf.Buyer3);\n                    sessionState.roleOf.Buyer4 && currentSubs.push(sessionState.roleOf.Buyer4);\n\n                    break;\n                default:\n                    currentSubs=[];\n                    break;\n            }\n    \n            currentSubs.filter(function (str) {return str.indexOf(myState.name) === -1}) //don't include self\n        }\n    \n        \n        function setTracks() {\n    \n            return new Promise( (resolve) => {\n    \n                //cycle through each participant in meeting\n                let ps = callObject.participants();\n                // console.log('The second participant is named: ' + Object.values(ps)[1].user_name);\n                Object.keys(ps).forEach((p) => {\n                    let participant = ps[p];\n                    let thisUserName = participant.user_name;\n    \n                    if (p === 'local' || thisUserName==myState.name) {\n                        return;\n                    } \n        \n    \n                    //if SESSION STATE NOT KNOWN, don't subscribe to anyone yet\n                    if (!sessionState.isKnown) {\n                        callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : false});\n                        return;\n                    }\n    \n    \n    \n                    // console.log(\"This username is: \" +thisUserName);\n    \n                    //If NOT ACTIVE, subscribe to everyone in the meeting\n                    if (!sessionState.isActive) {\n    \n                            if (thisUserName=='InvisibleScreenShareWidget') {\n                                console.log('Not subscribing to: ' + thisUserName);\n                                callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : { audio: false, video: false, screenVideo: true, screenAudio: true}});\n    \n                            \n                            } else {\n                                console.log('Subscribing to: ' + thisUserName);\n                                currentSubs.push(thisUserName);\n                                // if (!callObject.participants()[participant.session_id].tracks.video.subscribed){ \n                                //     callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : false});  \n                                // }\n                                callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : true});\n                                subscribedTo++;\n                                }    \n    \n                        // }\n    \n    \n    \n                    } \n    \n                    //IF ACTIVE (or selecting viewmode), just subscribe to those listed in currentSubs;\n                    else if (sessionState.isActive || viewMode) {\n                        if(currentSubs.includes(thisUserName+'_AUDIO')) {\n                            console.log('Subscribing to audio only for: ' + thisUserName);\n                            callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : { audio: true, video: false, screenVideo: false}});\n                        }\n                        else if(currentSubs.includes(thisUserName)) {\n                            console.log('Subscribing to: ' + thisUserName);\n                            callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : true});\n                            subscribedTo++;\n                        }\n                        else if (!currentSubs.includes(thisUserName)) {\n                            console.log('NOT subscribing to: ' + thisUserName + ', sessionID: ' + participant.session_id);\n                            callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : false});\n                        }\n                    }\n                });\n                resolve();\n            })\n        }\n        \n        setTracks().then(()=>{\n            \n            //remove screenshare widget from currentSubs array to not count it\n            const index = currentSubs.indexOf('InvisibleScreenShareWidget');\n            if (index > -1) {\n              currentSubs.splice(index, 1);\n            }\n    \n        //print subscriptions\n        currentSubs.filter(function (str) {return str.indexOf(window.myName) === -1}) //don't include self\n    \n        var iterator = currentSubs.values();\n        console.log(\"Currently subscribed to:\");\n        for (let elements of iterator) { \n            console.log(elements); \n        } \n        if (currentSubs.length < 1) {\n            console.log (\"No one.\")\n        }\n    \n        ///*** for debugging purposes\n        window.viewMode = viewMode;\n        window.currentSubs = currentSubs;\n        window.numberOfSubs=window.currentSubs && window.currentSubs.filter(function (str) {return str.indexOf('_AUDIO') === -1}).filter(function (str) {return str.indexOf('_AUDIO') === -1}).filter(function (str) {return str.indexOf(window.myName) === -1}).length;\n    \n    \n        })\n\n    },[sessionState,myState,callObject]);\n    \n\n   \n};\n\nexport default useSetSubscriptions;\n\n"]},"metadata":{},"sourceType":"module"}