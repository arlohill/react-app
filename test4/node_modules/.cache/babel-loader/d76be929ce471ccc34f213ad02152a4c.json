{"ast":null,"code":"// import { useEffect } from \"react\";\n// import SessionContext from '../../SessionContext';\nexport default function setSubscriptions(sessionState, myInfo, callObject) {\n  let wcurrentSubs = [];\n  console.log('Setting subscriptions...');\n  let subscribedTo = 0; //if session is active, set currentSubs accord to my role\n\n  if (sessionState.isActive) {\n    switch (myInfo.myRole) {\n      case 'Participant1':\n        currentSubs = [];\n        sessionState.roleOf.Actor2 && currentSubs.push(sessionState.roleOf.Actor2);\n        break;\n\n      case 'Participant2':\n        currentSubs = [];\n        sessionState.roleOf.Actor1 && currentSubs.push(sessionState.roleOf.Actor1);\n        break;\n\n      case 'Actor1':\n        currentSubs = [];\n        sessionState.roleOf.Participant2 && currentSubs.push(sessionState.roleOf.Participant2);\n        break;\n\n      case 'Actor2':\n        currentSubs = [];\n        sessionState.roleOf.Participant1 && currentSubs.push(sessionState.roleOf.Participant1);\n        break;\n\n      case 'Room3A':\n        currentSubs = [];\n        sessionState.roleOf.Room3B && currentSubs.push(sessionState.roleOf.Room3B);\n        break;\n\n      case 'Room3B':\n        currentSubs = [];\n        sessionState.roleOf.Room3A && currentSubs.push(sessionState.roleOf.Room3A);\n        break;\n\n      case 'Room4A':\n        currentSubs = [];\n        sessionState.roleOf.Room4B && currentSubs.push(sessionState.roleOf.Room4B);\n        break;\n\n      case 'Room4B':\n        currentSubs = [];\n        sessionState.roleOf.Room4A && currentSubs.push(sessionState.roleOf.Room4A);\n        break;\n\n      case 'Room5A':\n        currentSubs = [];\n        sessionState.roleOf.Room5B && currentSubs.push(sessionState.roleOf.Room5B);\n        break;\n\n      case 'Room5B':\n        currentSubs = [];\n        sessionState.roleOf.Room5A && currentSubs.push(sessionState.roleOf.Room5A);\n        break;\n\n      default:\n        break;\n    } //Add Admin to currentSubs if applicable\n\n\n    if (sessionState.AdminVisible) {\n      currentSubs.push(\"Admin\");\n    }\n  }\n\n  function setTracks() {\n    return new Promise(resolve => {\n      //cycle through each participant in meeting\n      let ps = callObject.participants();\n      let numberInMeeting = Object.keys(ps).length;\n      Object.keys(ps).forEach(p => {\n        let participant = ps[p];\n        let thisUserName = participant.user_name;\n\n        if (p === 'local' || !participant.owner) {\n          return;\n        } //If session is not active, subscribe to everyone in the meeting\n\n\n        if (!sessionState.isActive) {\n          if (thisUserName != 'Admin') {\n            // && thisUserName!=mutedParticipant\n            console.log('Subscribing to: ' + thisUserName);\n            callObject.updateParticipant(participant.session_id, {\n              setSubscribedTracks: true\n            });\n            subscribedTo++;\n          } else if (thisUserName == 'Admin' && sessionState.AdminVisible) {\n            console.log('Subscribing to Admin:');\n            callObject.updateParticipant(participant.session_id, {\n              setSubscribedTracks: true\n            });\n            subscribedTo++;\n          }\n        } //Otherwise, just subscribe to those listed in currentSubs;\n        else if (sessionState.isActive) {\n            if (currentSubs.includes(thisUserName)) {\n              console.log('Subscribing to: ' + thisUserName);\n              callObject.updateParticipant(participant.session_id, {\n                setSubscribedTracks: true\n              });\n              subscribedTo++;\n            } else if (!currentSubs.includes(thisUserName)) {\n              console.log('NOT subscribing to: ' + thisUserName);\n              callObject.updateParticipant(participant.session_id, {\n                setSubscribedTracks: false\n              });\n            }\n          }\n      });\n      resolve();\n    });\n  }\n\n  setTracks().then(() => {//if no admin (or admin has left), start asking for state\n    // if (adminPresent==false) {\n    //     sessionState.isKnown=false;\n    //     if (typeof(stateRequest)!='undefined') {clearInterval(stateRequest);}\n    //     stateRequest = setInterval(getState,2500);\n    //     console.log('no Admin present');\n    // }\n    // if (subscribedTo==0) {\n    //     window.isPopulated = false;\n    //     document.getElementById('empty-room').style.opacity='1';\n    //     if(!!document.querySelector(\"#root > div > div.daily-videos-wrapper > div.daily-video-div.remote.cam.cam-muted.mic-muted\")){document.querySelector(\"#root > div > div.daily-videos-wrapper > div.daily-video-div.remote.cam.cam-muted.mic-muted\").style.visibility='hidden';}\n    //     if (sessionState.isActive==true) {\n    //         document.getElementById('empty-text').innerHTML=\"Hold that thought! üòê <br><br> We're working to fix a connection problem.\"\n    //     } else if (sessionState.isActive==false) {\n    //         document.getElementById('empty-text').innerHTML=\"üëã <br>You're here!<br>Waiting for everyone else...\"\n    //     }\n    // } else if (subscribedTo>0) {\n    //     window.isPopulated = true;\n    //     document.getElementById('empty-room').style.opacity='0';\n    //     if (document.querySelector(\"#root > div > div.daily-videos-wrapper > div.daily-video-div.remote.cam.cam-muted.mic-muted\")){\n    //         document.querySelector(\"#root > div > div.daily-videos-wrapper > div.daily-video-div.remote.cam.cam-muted.mic-muted\").style.visibility='visible';\n    //     }\n    // }\n  }); //print subscriptions\n\n  var iterator = currentSubs.values();\n  console.log(\"Currently subscribed to:\");\n\n  for (let elements of iterator) {\n    console.log(elements);\n  }\n\n  if (currentSubs.length < 1) {\n    console.log(\"No one.\");\n  }\n}\n;","map":{"version":3,"sources":["/Users/arlosb/Documents/GitHub/new react app/test1/src/hooks/setSubscriptions.js"],"names":["setSubscriptions","sessionState","myInfo","callObject","wcurrentSubs","console","log","subscribedTo","isActive","myRole","currentSubs","roleOf","Actor2","push","Actor1","Participant2","Participant1","Room3B","Room3A","Room4B","Room4A","Room5B","Room5A","AdminVisible","setTracks","Promise","resolve","ps","participants","numberInMeeting","Object","keys","length","forEach","p","participant","thisUserName","user_name","owner","updateParticipant","session_id","setSubscribedTracks","includes","then","iterator","values","elements"],"mappings":"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","sourcesContent":["// import { useEffect } from \"react\";\n// import SessionContext from '../../SessionContext';\n\nexport default function setSubscriptions(sessionState,myInfo,callObject) {\n\n    let wcurrentSubs = [];\n\n    console.log('Setting subscriptions...');\n    let subscribedTo=0;\n    \n    //if session is active, set currentSubs accord to my role\n    if (sessionState.isActive) {\n        switch (myInfo.myRole) {\n            case 'Participant1':\n                currentSubs=[];\n                sessionState.roleOf.Actor2 && currentSubs.push(sessionState.roleOf.Actor2);\n                break;\n            case 'Participant2':\n                currentSubs=[];\n                sessionState.roleOf.Actor1 && currentSubs.push(sessionState.roleOf.Actor1);\n                break;\n            case 'Actor1':\n                currentSubs=[];\n                sessionState.roleOf.Participant2 && currentSubs.push(sessionState.roleOf.Participant2);\n                break;\n            case 'Actor2':\n                currentSubs=[];\n                sessionState.roleOf.Participant1 && currentSubs.push(sessionState.roleOf.Participant1);\n                break;\n            case 'Room3A':\n                currentSubs=[];\n                sessionState.roleOf.Room3B && currentSubs.push(sessionState.roleOf.Room3B);\n                break;\n            case 'Room3B':\n                currentSubs=[];\n                sessionState.roleOf.Room3A && currentSubs.push(sessionState.roleOf.Room3A);\n                break;\n            case 'Room4A':\n                currentSubs=[];\n                sessionState.roleOf.Room4B && currentSubs.push(sessionState.roleOf.Room4B);\n                break;\n            case 'Room4B':\n                currentSubs=[];\n                sessionState.roleOf.Room4A && currentSubs.push(sessionState.roleOf.Room4A);\n                break;\n             case 'Room5A':\n                currentSubs=[];\n                sessionState.roleOf.Room5B && currentSubs.push(sessionState.roleOf.Room5B);\n                break;\n            case 'Room5B':\n                currentSubs=[];\n                sessionState.roleOf.Room5A && currentSubs.push(sessionState.roleOf.Room5A);\n                break;\n            default:\n                break;\n        }\n        //Add Admin to currentSubs if applicable\n        if (sessionState.AdminVisible) {\n        currentSubs.push (\"Admin\");\n    }\n    }\n    \n\n    \n    function setTracks() {\n        return new Promise( (resolve) => {\n            //cycle through each participant in meeting\n            let ps = callObject.participants();\n            let numberInMeeting=Object.keys(ps).length;\n            Object.keys(ps).forEach((p) => {\n                let participant = ps[p];\n                let thisUserName = participant.user_name;\n                \n                if (p === 'local' || !participant.owner) {\n                    return;\n                } \n\n\n                //If session is not active, subscribe to everyone in the meeting\n                if (!sessionState.isActive) {\n                    if (thisUserName!='Admin') {  // && thisUserName!=mutedParticipant\n                        console.log('Subscribing to: ' + thisUserName);\n                        callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : true});\n                        subscribedTo++;\n                    } else if (thisUserName=='Admin' && sessionState.AdminVisible) {\n                        console.log('Subscribing to Admin:');\n                        callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : true});\n                        subscribedTo++;\n                    } \n\n                } \n\n                //Otherwise, just subscribe to those listed in currentSubs;\n                else if (sessionState.isActive) {\n                    if(currentSubs.includes(thisUserName)) {\n                        console.log('Subscribing to: ' + thisUserName);\n                        callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : true});\n                        subscribedTo++;\n                    }\n                    else if (!currentSubs.includes(thisUserName)) {\n                        console.log('NOT subscribing to: ' + thisUserName);\n                        callObject.updateParticipant(participant.session_id,{ setSubscribedTracks : false});\n                    }\n                }\n            });\n            resolve()\n        })\n    }\n    \n    setTracks().then(()=>{\n        //if no admin (or admin has left), start asking for state\n        // if (adminPresent==false) {\n        //     sessionState.isKnown=false;\n        //     if (typeof(stateRequest)!='undefined') {clearInterval(stateRequest);}\n        //     stateRequest = setInterval(getState,2500);\n        //     console.log('no Admin present');\n        // }\n        // if (subscribedTo==0) {\n        //     window.isPopulated = false;\n        //     document.getElementById('empty-room').style.opacity='1';\n        //     if(!!document.querySelector(\"#root > div > div.daily-videos-wrapper > div.daily-video-div.remote.cam.cam-muted.mic-muted\")){document.querySelector(\"#root > div > div.daily-videos-wrapper > div.daily-video-div.remote.cam.cam-muted.mic-muted\").style.visibility='hidden';}\n        //     if (sessionState.isActive==true) {\n        //         document.getElementById('empty-text').innerHTML=\"Hold that thought! üòê <br><br> We're working to fix a connection problem.\"\n        //     } else if (sessionState.isActive==false) {\n        //         document.getElementById('empty-text').innerHTML=\"üëã <br>You're here!<br>Waiting for everyone else...\"\n\n        //     }\n        // } else if (subscribedTo>0) {\n        //     window.isPopulated = true;\n        //     document.getElementById('empty-room').style.opacity='0';\n        //     if (document.querySelector(\"#root > div > div.daily-videos-wrapper > div.daily-video-div.remote.cam.cam-muted.mic-muted\")){\n        //         document.querySelector(\"#root > div > div.daily-videos-wrapper > div.daily-video-div.remote.cam.cam-muted.mic-muted\").style.visibility='visible';\n        //     }\n\n        // }\n\n    })\n\n    //print subscriptions\n    var iterator = currentSubs.values();\n    console.log(\"Currently subscribed to:\");\n    for (let elements of iterator) { \n        console.log(elements); \n    } \n    if (currentSubs.length < 1) {\n        console.log (\"No one.\")\n    }\n};\n\n"]},"metadata":{},"sourceType":"module"}